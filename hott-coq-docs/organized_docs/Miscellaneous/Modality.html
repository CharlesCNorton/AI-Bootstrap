<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Modality</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Modality</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">HoTT.Basics</span> <span class="id" title="var">HoTT.Types</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">HFiber</span> <span class="id" title="var">Extensions</span> <span class="id" title="var">Factorization</span> <span class="id" title="var">Limits.Pullback</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">ReflectiveSubuniverse</span>. <span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="keyword">Export</span></span>&nbsp;because&nbsp;many&nbsp;of&nbsp;the&nbsp;lemmas&nbsp;and&nbsp;facts&nbsp;about&nbsp;reflective&nbsp;subuniverses&nbsp;are&nbsp;equally&nbsp;important&nbsp;for&nbsp;modalities.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">path_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1233"></a><h1 class="section">Modalities</h1>

<div class="paragraph"> </div>

<a id="lab1234"></a><h2 class="section">Dependent eliminators</h2>

<div class="paragraph"> </div>

 A dependent version of the reflection universal property.  For later use we generalize it to refer to different subuniverses in the reflection and the elimination target. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">ReflectsD@</span>{<span class="id" title="var">i</span>} (<span class="id" title="var">O'</span> <span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">PreReflects@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">O'</span> <span class="id" title="var">T</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">extendable_to_OO</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">Q</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) {<span class="id" title="var">Q_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">Q</span> <span class="id" title="var">x</span>)},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">T</span>) <span class="id" title="var">Q</span><br/>
}.<br/>

<br/>
</div>

<div class="doc">
In particular, from this we get a dependent eliminator. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_ind</span> {<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">oa</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">B</span> <span class="id" title="var">oa</span><br/>
&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">extendable_to_OO</span> <span class="id" title="var">B</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">f</span>).1 <span class="id" title="var">oa</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_ind_beta</span> {<span class="id" title="var">O'</span> <span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">OO_ind</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">extendable_to_OO</span> <span class="id" title="var">B</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">f</span>).2 <span class="id" title="var">a</span>.<br/>

<br/>
</div>

<div class="doc">
Conversely, if <span class="inlinecode"><span class="id" title="var">O</span></span> is closed under path-types, a dependent eliminator suffices to prove the whole dependent universal property. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflectsD_from_OO_ind@</span>{<span class="id" title="var">i</span>} {<span class="id" title="var">O'</span> <span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} `{<span class="id" title="var">PreReflects</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">OO_ind'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">oa</span>, <span class="id" title="var">B</span> <span class="id" title="var">oa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">OO_ind_beta'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span>, <span class="id" title="var">OO_ind'</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">inO_paths'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">B_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">z</span> <span class="id" title="var">z'</span> : <span class="id" title="var">B</span>), <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">z</span> = <span class="id" title="var">z'</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q_inO</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q_inO</span>. <span class="id" title="var">simple_induction</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">IHn</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q_inO</span>.<br/>
&nbsp;&nbsp;1:<span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">OO_ind'</span> <span class="id" title="var">Q</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">OO_ind_beta'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, this is the case if <span class="inlinecode"><span class="id" title="var">O</span></span> is a reflective subuniverse. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflectsD_from_RSU</span> {<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} {<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">PreReflects</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">OO_ind'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">oa</span>, <span class="id" title="var">B</span> <span class="id" title="var">oa</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">OO_ind_beta'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span>, <span class="id" title="var">OO_ind'</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">reflectsD_from_OO_ind</span> <span class="id" title="var">OO_ind'</span> <span class="id" title="var">OO_ind_beta'</span> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
Of course, with funext this becomes an actual equivalence. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_oD_to_O</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">O'</span> <span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">h</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">B</span> <span class="id" title="var">oa</span>) =&gt; <span class="id" title="var">h</span> <span class="id" title="var">oD</span> <span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isequiv_ooextendable</span>, <span class="id" title="var">extendable_to_OO</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1235"></a><h2 class="section">The strong order</h2>

<div class="paragraph"> </div>

 Note the reversal of the order: <span class="inlinecode"><span class="id" title="var">O1</span></span> <span class="inlinecode">&lt;&lt;</span> <span class="inlinecode"><span class="id" title="var">O2</span></span> means that <span class="inlinecode"><span class="id" title="var">O2</span></span> has dependent eliminators into <span class="inlinecode"><span class="id" title="var">O1</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">O_strong_leq</span> (<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">reflectsD_strong_leq</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">A</span>, <span class="id" title="var">ReflectsD</span> <span class="id" title="var">O2</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">reflectsD_strong_leq</span>.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;&lt;&lt;" := <span class="id" title="var">O_strong_leq</span> : <span class="id" title="var">subuniverse_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">subuniverse_scope</span>.<br/>

<br/>
</div>

<div class="doc">
The strong order implies the weak order. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">O_leq_strong_leq</span> {<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse</span>} `{<span class="id" title="var">O1</span> &lt;&lt; <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">O1</span> &lt;= <span class="id" title="var">O2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">A_inO1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">inO_to_O_retract</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">OO_ind</span> <span class="id" title="var">O1</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span>:<span class="id" title="var">O2</span> <span class="id" title="var">A</span> =&gt; <span class="id" title="var">A</span>) <span class="id" title="var">idmap</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>. <span class="id" title="var">srapply</span> <span class="id" title="var">OO_ind_beta</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The strong order is not obviously transitive, but it composes with the weak order on one side at least. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_strong_leq_trans_l</span> (<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">O3</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O1</span> &lt;= <span class="id" title="var">O2</span>} `{<span class="id" title="var">O2</span> &lt;&lt; <span class="id" title="var">O3</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">O1</span> &lt;&lt; <span class="id" title="var">O3</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">extendable_to_OO</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O2</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">inO_leq</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">B_inO</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1236"></a><h2 class="section">Modalities</h2>

<div class="paragraph"> </div>

 A modality is a reflective subuniverse with a dependent universal property with respect to itself. 
</div>
<div class="code">
<span class="id" title="keyword">Notation</span> <span class="id" title="var">IsModality</span> <span class="id" title="var">O</span> := (<span class="id" title="var">O</span> &lt;&lt; <span class="id" title="var">O</span>).<br/>

<br/>
</div>

<div class="doc">
However, it's not clear what the best bundled definition of modality is.  The obvious one <span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">ReflectiveSubuniverse</span></span> <span class="inlinecode">&amp;</span> <span class="inlinecode"><span class="id" title="var">IsModality</span></span> <span class="inlinecode"><span class="id" title="var">O</span>}</span> has the advantage that bundling a reflective subuniverse into a modality and then unbundling it is definitionally the identity; but it is redundant, since the dependent universal property implies the non-dependent one, and in practice most modalities are constructed directly with a dependent eliminator.  Thus, for now at least, we take the following definition, which in RSS is called a "uniquely eliminating modality".  
</div>
<div class="code">
<span class="id" title="keyword">Record</span> <span class="id" title="var">Modality@</span>{<span class="id" title="var">i</span>} := <span class="id" title="var">Build_Modality'</span><br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">modality_subuniv</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>} ;<br/>
&nbsp;&nbsp;<span class="id" title="var">modality_prereflects</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">PreReflects</span> <span class="id" title="var">modality_subuniv</span> <span class="id" title="var">T</span> ;<br/>
&nbsp;&nbsp;<span class="id" title="var">modality_reflectsD</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ReflectsD</span> <span class="id" title="var">modality_subuniv</span> <span class="id" title="var">modality_subuniv</span> <span class="id" title="var">T</span> ;<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">modality_reflectsD</span>.<br/>
</div>

<div class="doc">
We don't declare <span class="inlinecode"><span class="id" title="var">modality_subuniv</span></span> as a coercion or <span class="inlinecode"><span class="id" title="var">modality_prereflects</span></span> as a global instance, because we want them only to be found by way of the following "unbundling" coercion to reflective subuniverses. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">modality_to_reflective_subuniverse</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Modality@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;: <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i</span>}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_ReflectiveSubuniverse</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">modality_subuniv</span> <span class="id" title="var">O</span>) (<span class="id" title="var">modality_prereflects</span> <span class="id" title="var">O</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">T</span>; <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">extendable_to_OO</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">modality_to_reflective_subuniverse</span> : <span class="id" title="var">Modality</span> &gt;-&gt; <span class="id" title="var">ReflectiveSubuniverse</span>.<br/>

<br/>
</div>

<div class="doc">
Unfortunately, sometimes <span class="inlinecode"><span class="id" title="var">modality_subuniv</span></span> pops up anyway.  The following hint helps typeclass inference look through it. 
</div>
<div class="code">
#[<span class="id" title="var">export</span>]<br/>
<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 0 (<span class="id" title="var">In</span> (<span class="id" title="var">modality_subuniv</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="tactic">change</span> <span class="id" title="var">modality_subuniv</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">rsu_subuniv</span> <span class="id" title="var">o</span> <span class="id" title="var">modality_to_reflective_subuniverse</span>) <span class="id" title="tactic">in</span> * : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
Modalities are precisely the reflective subuniverses that are <span class="inlinecode">&lt;&lt;</span> themselves.  
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ismodality_modality</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>) : <span class="id" title="var">IsModality</span> <span class="id" title="var">O</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">modality_ismodality</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) `{<span class="id" title="var">IsModality</span> <span class="id" title="var">O</span>} : <span class="id" title="var">Modality</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">Build_Modality'</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
When combined with <span class="inlinecode"><span class="id" title="var">isequiv_oD_to_O</span></span>, this yields Theorem 7.7.7 in the book. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_oD_to_O_modality</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">Funext</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>) {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">h</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">B</span> <span class="id" title="var">oa</span>) =&gt; <span class="id" title="var">h</span> <span class="id" title="var">oD</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> (<span class="id" title="var">isequiv_oD_to_O</span> <span class="id" title="var">O</span> <span class="id" title="var">O</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Of course, modalities have dependent eliminators. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_ind</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;:= @<span class="id" title="var">OO_ind</span> <span class="id" title="var">O</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_ind</span> {<span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">B</span> {<span class="id" title="var">B_inO</span>} <span class="id" title="var">f</span> <span class="id" title="var">oa</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_ind_beta</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;:= @<span class="id" title="var">OO_ind_beta</span> <span class="id" title="var">O</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_ind_beta</span> {<span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">B</span> {<span class="id" title="var">B_inO</span>} <span class="id" title="var">f</span> <span class="id" title="var">a</span>.<br/>

<br/>
</div>

<div class="doc">
Conversely, as remarked above, we can build a modality from a dependent eliminator as long as we assume the modal types are closed under paths.  This is probably the most common way to define a modality, and one might argue that this would be a better definition of the bundled type <span class="inlinecode"><span class="id" title="var">Modality</span></span>.  For now we simply respect that by dignifying it with the unprimed constructor name <span class="inlinecode"><span class="id" title="var">Build_Modality</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Build_Modality</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">In'</span> : <span class="id" title="keyword">Type</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">hprop_inO'</span> : <span class="id" title="var">Funext</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>, <span class="id" title="var">IsHProp</span> (<span class="id" title="var">In'</span> <span class="id" title="var">T</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">inO_equiv_inO'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In'</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">U</span>, <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span> -&gt; <span class="id" title="var">In'</span> <span class="id" title="var">U</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_reflector'</span> : <span class="id" title="keyword">Type</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_inO'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">T</span>, <span class="id" title="var">In'</span> (<span class="id" title="var">O_reflector'</span> <span class="id" title="var">T</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">to'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">T</span>, <span class="id" title="var">T</span> -&gt; <span class="id" title="var">O_reflector'</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_ind'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In'</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">z</span> : <span class="id" title="var">O_reflector'</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_ind_beta'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In'</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_ind'</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span> <span class="id" title="var">f</span> (<span class="id" title="var">to'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">inO_paths'</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">A_inO</span> : <span class="id" title="var">In'</span> <span class="id" title="var">A</span>) (<span class="id" title="var">z</span> <span class="id" title="var">z'</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In'</span> (<span class="id" title="var">z</span> = <span class="id" title="var">z'</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="var">Modality</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">O</span> := <span class="id" title="var">Build_Subuniverse</span> <span class="id" title="var">In'</span> <span class="id" title="var">hprop_inO'</span> <span class="id" title="var">inO_equiv_inO'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_Modality'</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">Build_PreReflects</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> (<span class="id" title="var">O_reflector'</span> <span class="id" title="var">T</span>) (<span class="id" title="var">O_inO'</span> <span class="id" title="var">T</span>) (<span class="id" title="var">to'</span> <span class="id" title="var">T</span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="var">srapply</span> <span class="id" title="var">reflectsD_from_OO_ind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">rapply</span> <span class="id" title="var">O_ind'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">rapply</span> <span class="id" title="var">O_ind_beta'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">rapply</span> <span class="id" title="var">inO_paths'</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic that extends <span class="inlinecode"><span class="id" title="var">strip_reflections</span></span> to modalities. It handles non-dependent elimination for reflective subuniverses and dependent elimination for modalities. <span class="inlinecode"><span class="id" title="var">strip_truncations</span></span> does the same for truncations, but introduces fewer universe variables, so tends to work better when removing truncations. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">strip_modalities</span> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc">
Search for hypotheses of type <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> for some <span class="inlinecode"><span class="id" title="var">O</span></span> such that the goal is <span class="inlinecode"><span class="id" title="var">O</span></span>-local. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">T</span> : <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id" title="var">revert_opaque</span> <span class="id" title="var">T</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Handle the non-dependent and dependent cases.  The last case requires that <span class="inlinecode"><span class="id" title="var">O</span></span> be a modality. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (@<span class="id" title="var">O_rec</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) || <span class="id" title="tactic">refine</span> (@<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) || <span class="id" title="tactic">refine</span> (@<span class="id" title="var">O_ind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Ensure that we didn't generate more than one subgoal, i.e. that the goal was appropriately local. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1237"></a><h2 class="section">Dependent sums</h2>

<div class="paragraph"> </div>

 A dependent elimination of a reflective subuniverse <span class="inlinecode"><span class="id" title="var">O'</span></span> into <span class="inlinecode"><span class="id" title="var">O</span></span> implies that the sum of a family of <span class="inlinecode"><span class="id" title="var">O</span></span>-modal types over an <span class="inlinecode"><span class="id" title="var">O'</span></span>-modal type is <span class="inlinecode"><span class="id" title="var">O'</span></span>-modal.  More specifically, for a particular such sum it suffices for the <span class="inlinecode"><span class="id" title="var">O'</span></span>-reflection of that sum to dependently eliminate into <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_sigma_reflectsD</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>} {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) `{!<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> (<span class="id" title="var">sig</span> <span class="id" title="var">B</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>} `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O'</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">x</span>}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">h</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; @<span class="id" title="var">O_rec</span> <span class="id" title="var">O'</span> ({<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">x</span>}) <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">pr1</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">p</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> =&gt; <span class="id" title="var">O_rec_beta</span> <span class="id" title="var">pr1</span> <span class="id" title="var">z</span>) : <span class="id" title="var">h</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">_</span>) == <span class="id" title="var">pr1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">g</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> =&gt; (<span class="id" title="var">transport</span> <span class="id" title="var">B</span> ((<span class="id" title="var">p</span> <span class="id" title="var">z</span>)^) <span class="id" title="var">z</span>.2)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">f</span> := <span class="id" title="var">OO_ind</span> <span class="id" title="var">O</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span>:<span class="id" title="var">O'</span> (<span class="id" title="var">sig</span> <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">B</span> (<span class="id" title="var">h</span> <span class="id" title="var">x</span>)) <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">q</span> := <span class="id" title="var">OO_ind_beta</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span>:<span class="id" title="var">O'</span> (<span class="id" title="var">sig</span> <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">B</span> (<span class="id" title="var">h</span> <span class="id" title="var">x</span>)) <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_to_O_retract</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">mu</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">w</span> =&gt; (<span class="id" title="var">h</span> <span class="id" title="var">w</span>; <span class="id" title="var">f</span> <span class="id" title="var">w</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">x1</span> <span class="id" title="var">x2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">path_sigma</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">_</span> (<span class="id" title="var">q</span> (<span class="id" title="var">x1</span>;<span class="id" title="var">x2</span>)) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">g</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">exact</span> (<span class="id" title="var">transport_pV</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Specialized to a modality, this yields the implication (ii) =&gt; (i) from Theorem 7.7.4 of the book, and also Corollary 7.7.8, part 2. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_sigma</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">x</span>}<br/>
&nbsp;&nbsp;:= <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
This implies that the composite of modal maps is modal. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_compose</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>} {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO'</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_compose</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">c</span>)^-1).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It also implies Corollary 7.3.10 from the book, generalized to modalities.  (Theorem 7.3.9 is true for any reflective subuniverse; we called it <span class="inlinecode"><span class="id" title="var">equiv_O_sigma_O</span></span>.) 
</div>
<div class="code">
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">equiv_sigma_inO_O</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>} {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;: {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>)} &lt;~&gt; <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span>}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>)}).<br/>
&nbsp;&nbsp;- <span class="id" title="var">rapply</span> <span class="id" title="var">equiv_to_O</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_sigma_O</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Conversely, if the sum of a particular family of <span class="inlinecode"><span class="id" title="var">O</span></span>-modal types over an <span class="inlinecode"><span class="id" title="var">O'</span></span>-reflection is in <span class="inlinecode"><span class="id" title="var">O'</span></span>, then that family admits a dependent eliminator. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">extension_from_inO_sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>} `{<span class="id" title="var">Reflects</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>} (<span class="id" title="var">B</span>: <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">inO_sigma</span> : <span class="id" title="var">In</span> <span class="id" title="var">O'</span> {<span class="id" title="var">z</span>:<span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">z</span>}}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="var">ExtensionAlong</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>) <span class="id" title="var">B</span> <span class="id" title="var">g</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Z</span> := <span class="id" title="var">sig</span> <span class="id" title="var">B</span>) <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">g'</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span> =&gt; (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span> ; <span class="id" title="var">g</span> <span class="id" title="var">a</span>)) : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Z</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">f'</span> := <span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O'</span>) <span class="id" title="var">g'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">eqf</span> := (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">g'</span>)  : <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> == <span class="id" title="var">g'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">eqid</span> := <span class="id" title="var">O_indpaths</span> (<span class="id" title="var">pr1</span> <span class="id" title="var">o</span> <span class="id" title="var">f'</span>) <span class="id" title="var">idmap</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">ap@</span>{<span class="id" title="var">k</span> <span class="id" title="var">i</span>} <span class="id" title="var">pr1</span> (<span class="id" title="var">eqf</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> =&gt; <span class="id" title="var">transport</span> <span class="id" title="var">B</span> (<span class="id" title="var">eqid</span> <span class="id" title="var">z</span>) ((<span class="id" title="var">f'</span> <span class="id" title="var">z</span>).2)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">eqid</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ <span class="id" title="var">pr2_path</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">g'</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">transport</span> <span class="id" title="var">B</span> <span class="id" title="var">p</span> (<span class="id" title="var">O_rec</span> <span class="id" title="var">g'</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)).2) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">O_indpaths_beta</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And even a full equivalence of spaces of sections.  This is stated in CORS Proposition 2.8 (but our version avoids funext by using <span class="inlinecode"><span class="id" title="var">ooExtendableAlong</span></span>, as usual).  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_from_inO_sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span>: <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">inO_sigma</span> : <span class="id" title="var">In</span> <span class="id" title="var">O'</span> {<span class="id" title="var">z</span>:<span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">z</span>}}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>) <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IHn</span>]; <span class="id" title="tactic">intros</span>; [ <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span> | <span class="id" title="var">cbn</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">extension_from_inO_sigma</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> , <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span>; <span class="id" title="var">nrapply</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Z</span> := <span class="id" title="var">sig</span> <span class="id" title="var">B</span>) <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">W</span> := <span class="id" title="var">sig</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">B</span> <span class="id" title="var">a</span> * <span class="id" title="var">B</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">nrefine</span> (<span class="id" title="var">inO_equiv_inO'</span> (<span class="id" title="var">Pullback</span> (<span class="id" title="var">A</span> := <span class="id" title="var">W</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span>:<span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> =&gt; (<span class="id" title="var">a</span>;(<span class="id" title="var">h</span> <span class="id" title="var">a</span>,<span class="id" title="var">k</span> <span class="id" title="var">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">z</span>:<span class="id" title="var">Z</span> =&gt; (<span class="id" title="var">z</span>.1;(<span class="id" title="var">z</span>.2,<span class="id" title="var">z</span>.2)))) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_pullback</span> <span class="id" title="var">O'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO'</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_sigprod_pullback</span> <span class="id" title="var">B</span> <span class="id" title="var">B</span>)^-1). }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Pullback</span>.<br/>
</div>

<div class="doc">
The rest is just extracting paths from sigma- and product types and contracting a couple of based path spaces. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_functor_sigma_id</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_functor_sigma_id</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;2:<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_path_sigma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_functor_sigma_id</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> =&gt; <span class="id" title="var">equiv_functor_sigma_id</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">_</span>))).<br/>
&nbsp;&nbsp;2:<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_path_prod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="var">make_equiv_contr_basedpaths</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Thus, if this holds for all sigma-types, we get the dependent universal property.  Making this an <span class="inlinecode"><span class="id" title="keyword">Instance</span></span> causes typeclass search to spin.  Note the slightly different hypotheses, which mean that we can't just use the previous result: here we need only assume that the <span class="inlinecode"><span class="id" title="var">O'</span></span>-reflection of <span class="inlinecode"><span class="id" title="var">A</span></span> exists rather than that <span class="inlinecode"><span class="id" title="var">O'</span></span> is fully reflective, at the cost of assuming that <span class="inlinecode"><span class="id" title="var">O</span></span> is fully reflective (although actually, closed under path-spaces would suffice). 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflectsD_from_inO_sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">Reflects</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">inO_sigma</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span>: <span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>)) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">O'</span> {<span class="id" title="var">z</span>:<span class="id" title="var">O_reflector</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">z</span>})<br/>
&nbsp;&nbsp;: <span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IHn</span>]; <span class="id" title="tactic">intros</span>; [ <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span> | <span class="id" title="var">cbn</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">extension_from_inO_sigma</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> , <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, we get the converse implication (i) =&gt; (ii) from Theorem 7.7.4 of the book: a reflective subuniverse closed under sigmas is a modality. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">modality_from_inO_sigma</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">H</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span>:<span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">In</span> <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">x</span>}))<br/>
&nbsp;&nbsp;: <span class="id" title="var">Modality</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_Modality'</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">srapply</span> <span class="id" title="var">reflectsD_from_inO_sigma</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1238"></a><h2 class="section">Connectedness of the units</h2>

<div class="paragraph"> </div>

 Dependent reflection can also be characterized by connectedness of the unit maps. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_to_O_reflectsD</span> {<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P_inO</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">extendable_to_OO</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) <span class="id" title="var">P</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflectsD_from_conn_map_to_O</span> {<span class="id" title="var">O'</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">PreReflects</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">O'</span> <span class="id" title="var">A</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ReflectsD</span> <span class="id" title="var">O'</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, if <span class="inlinecode"><span class="id" title="var">O1</span></span> <span class="inlinecode">&lt;&lt;</span> <span class="inlinecode"><span class="id" title="var">O2</span></span> then every <span class="inlinecode"><span class="id" title="var">O2</span></span>-unit is <span class="inlinecode"><span class="id" title="var">O1</span></span>-connected. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_to_O_strong_leq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse</span>} `{<span class="id" title="var">O1</span> &lt;&lt; <span class="id" title="var">O2</span>} (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O1</span> (<span class="id" title="var">to</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
Thus, if <span class="inlinecode"><span class="id" title="var">O</span></span> is a modality, then every <span class="inlinecode"><span class="id" title="var">O</span></span>-unit is <span class="inlinecode"><span class="id" title="var">O</span></span>-connected.  This is Corollary 7.5.8 in the book. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_to_O</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>} (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
When <span class="inlinecode"><span class="id" title="var">O1</span></span> <span class="inlinecode">&lt;&lt;</span> <span class="inlinecode"><span class="id" title="var">O2</span></span>, <span class="inlinecode"><span class="id" title="var">O_functor</span></span> <span class="inlinecode"><span class="id" title="var">O2</span></span> preserves <span class="inlinecode"><span class="id" title="var">O1</span></span>-connected maps. 
</div>
<div class="code">
<span class="id" title="keyword">Proposition</span> <span class="id" title="var">conn_map_O_functor_strong_leq</span> {<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse</span>} (<span class="id" title="var">leq</span> : <span class="id" title="var">O1</span> &lt;&lt; <span class="id" title="var">O2</span>)<br/>
&nbsp;&nbsp;{<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">Y</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O1</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O1</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">O2</span> <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">cancelR_conn_map</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">O2</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">nrapply</span> <span class="id" title="var">conn_map_homotopic</span>.<br/>
&nbsp;&nbsp;1: <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">conn_map_compose</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1239"></a><h2 class="section">Easy modalities</h2>

<div class="paragraph"> </div>

 The book uses yet a different definition of modality, which requires an induction principle only into families of the form <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">oa</span></span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode">(<span class="id" title="var">B</span></span> <span class="inlinecode"><span class="id" title="var">oa</span>)</span>, and similarly only that path-spaces of types <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> are "modal" in the sense that the unit is an equivalence.  As shown in section 1 of RSS, this is equivalent, roughly since every modal type <span class="inlinecode"><span class="id" title="var">A</span></span> (in this sense) is equivalent to <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>.

<div class="paragraph"> </div>

Our definitions are more convenient in formalized applications because in some examples (such as <span class="inlinecode"><span class="id" title="var">Trunc</span></span> and closed modalities), there is a naturally occurring <span class="inlinecode"><span class="id" title="var">O_ind</span></span> into all modal types that is not judgmentally equal to the one that can be constructed by passing through <span class="inlinecode"><span class="id" title="var">O</span></span> and back again.  Thus, when we apply general theorems about modalities to a particular modality such as <span class="inlinecode"><span class="id" title="var">Trunc</span></span>, the proofs will reduce definitionally to "the way we would have proved them directly" if we didn't know about general modalities.

<div class="paragraph"> </div>

On the other hand, in other examples (such as <span class="inlinecode">~~</span> and open modalities) it is easier to construct the latter weaker induction principle.  Thus, we now show how to get from that to our definition of modality. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">EasyModalities</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Universe</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O_reflector</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">to</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}), <span class="id" title="var">T</span> -&gt; <span class="id" title="var">O_reflector</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_indO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">O_reflector</span> (<span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">z</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_reflector</span> (<span class="id" title="var">B</span> <span class="id" title="var">z</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_indO_beta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">O_reflector</span> (<span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_indO</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">inO_pathsO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">z</span> <span class="id" title="var">z'</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> (<span class="id" title="var">z</span> = <span class="id" title="var">z'</span>))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">In_easy</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">A</span> =&gt; <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">O_ind_easy</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In_easy</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)) -&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">B</span> <span class="id" title="var">oa</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">oa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">H</span> := <span class="id" title="var">B_inO</span> <span class="id" title="var">oa</span>); <span class="id" title="tactic">unfold</span> <span class="id" title="var">In_easy</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> ((<span class="id" title="var">to</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to</span>, <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">O_ind_easy_beta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">B_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">oa</span>, <span class="id" title="var">In_easy</span> (<span class="id" title="var">B</span> <span class="id" title="var">oa</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">A</span>, <span class="id" title="var">B</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">a</span>:<span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">O_ind_easy</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) = <span class="id" title="var">f</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_ind_easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> @<span class="id" title="var">O_indO_beta</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">_</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">O_inO_easy</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">In_easy</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> (<span class="id" title="var">to</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_indO</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">A</span>) <span class="id" title="var">idmap</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">pattern</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_ind_easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">oa</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">inO_pathsO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">O_indO_beta</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">A</span>) <span class="id" title="var">idmap</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">O_indO_beta</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">A</span>) <span class="id" title="var">idmap</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It seems to be surprisingly hard to show repleteness (without univalence).  We basically have to manually develop enough functoriality of <span class="inlinecode"><span class="id" title="var">O</span></span> and naturality of <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">inO_equiv_inO_easy</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A_inO</span> : <span class="id" title="var">In_easy</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">feq</span> : <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In_easy</span> <span class="id" title="var">B</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_commsq</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">B</span>) <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_ind_easy</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O_reflector</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">B</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_inO_easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind_easy_beta</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O_reflector</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">A_inO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_ind_easy</span> <span class="id" title="var">B</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O_reflector</span> <span class="id" title="var">A</span>) <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">A</span> (<span class="id" title="var">f</span>^-1 <span class="id" title="var">b</span>))) <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_inO_easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">pattern</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind_easy</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">inO_pathsO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">abstract</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_ind_easy_beta</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">eisretr</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">pattern</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind_easy</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">inO_pathsO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">abstract</span> (<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_ind_easy_beta</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">eissect</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Definition</span> <span class="id" title="var">inO_paths_easy</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">A_inO</span> : <span class="id" title="var">In_easy</span> <span class="id" title="var">A</span>) (<span class="id" title="var">a</span> <span class="id" title="var">a'</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In_easy</span> (<span class="id" title="var">a</span> = <span class="id" title="var">a'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO_easy</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span> = <span class="id" title="var">to</span> <span class="id" title="var">A</span> <span class="id" title="var">a'</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">ap</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span> <span class="id" title="var">a'</span>)^-1 <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">inO_pathsO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (@<span class="id" title="var">isequiv_ap</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">A_inO</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">isequiv_inverse</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">easy_modality</span> : <span class="id" title="var">Modality</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Modality</span> <span class="id" title="var">In_easy</span> <span class="id" title="var">_</span> <span class="id" title="var">inO_equiv_inO_easy</span> <span class="id" title="var">O_reflector</span> <span class="id" title="var">O_inO_easy</span> <span class="id" title="var">to</span> <span class="id" title="var">O_ind_easy</span> <span class="id" title="var">O_ind_easy_beta</span> <span class="id" title="var">inO_paths_easy</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">EasyModalities</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1240"></a><h2 class="section">The modal factorization system</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ModalFact</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> `{<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Modality</span>).<br/>

<br/>
</div>

<div class="doc">
Lemma 7.6.4 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">image</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">Factorization</span> (@<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span>) (@<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span>) <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">mapinO_pr1</span>. </div>

<div class="doc">
Slightly speeds up next line. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_Factorization</span> {<span class="id" title="var">b</span> : <span class="id" title="var">B</span> &amp; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; (<span class="id" title="var">f</span> <span class="id" title="var">a</span> ; <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">a</span>;1)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pr1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">conn_map_functor_sigma</span>. </div>

<div class="doc">
Slightly speeds up next line. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">conn_map_compose</span> <span class="id" title="var">O</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_fibration_replacement</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">functor_sigma</span> <span class="id" title="var">idmap</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_factor1_image</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">factor1</span> (<span class="id" title="var">image</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">inclass1</span> (<span class="id" title="var">image</span> <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_map_factor1_image</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">factor2</span> (<span class="id" title="var">image</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">inclass2</span> (<span class="id" title="var">image</span> <span class="id" title="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
This is the composite of the three displayed equivalences at the beginning of the proof of Lemma 7.6.5.  Note that it involves only a single factorization of <span class="inlinecode"><span class="id" title="var">f</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">O_hfiber_O_fact</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fact</span> : <span class="id" title="var">Factorization</span> (@<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span>) (@<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span>) <span class="id" title="var">f</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> <span class="id" title="var">o</span> <span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>) <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;~&gt; <span class="id" title="var">hfiber</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span>) <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_O_functor</span> <span class="id" title="var">O</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">hfiber_compose</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>) (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span>) <span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nrefine</span> (<span class="id" title="var">equiv_sigma_contr</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">w</span> =&gt; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>) <span class="id" title="var">w</span>.1)) <span class="id" title="var">oE</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">w</span>; <span class="id" title="tactic">exact</span> (<span class="id" title="var">inclass1</span> <span class="id" title="var">fact</span> <span class="id" title="var">w</span>.1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">nrefine</span> ((<span class="id" title="var">equiv_sigma_inO_O</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">w</span> =&gt; <span class="id" title="var">hfiber</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>) <span class="id" title="var">w</span>.1))^-1)%<span class="id" title="var">equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inclass2</span> <span class="id" title="var">fact</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
This is the corresponding first three of the displayed "mapsto"s in proof of Lemma 7.6.5, and also the last three in reverse order, generalized to an arbitrary path <span class="inlinecode"><span class="id" title="var">p</span></span>.  Note that it is much harder to prove than in the book, because we are working in the extra generality of a modality where <span class="inlinecode"><span class="id" title="var">O_ind_beta</span></span> is only propositional. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">O_hfiber_O_fact_inverse_beta</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fact</span> : <span class="id" title="var">Factorization</span> (@<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span>) (@<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span>) <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span> <span class="id" title="var">a</span>) = <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;: (<span class="id" title="var">O_hfiber_O_fact</span> <span class="id" title="var">fact</span> <span class="id" title="var">b</span>)^-1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span> <span class="id" title="var">a</span> ; <span class="id" title="var">p</span>) = <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">a</span> ; <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">g</span> := <span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>); <span class="id" title="tactic">set</span> (<span class="id" title="var">h</span> := <span class="id" title="var">factor2</span> <span class="id" title="var">fact</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_hfiber_O_fact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ev_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveL_equiv_M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">exist</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">w</span> : <span class="id" title="var">hfiber</span> <span class="id" title="var">h</span> <span class="id" title="var">b</span>) =&gt; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">g</span> <span class="id" title="var">w</span>.1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> <span class="id" title="var">a</span>; <span class="id" title="var">p</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">g</span> (<span class="id" title="var">g</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">a</span> ; 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">moveL_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">exist</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">w</span> : <span class="id" title="var">hfiber</span> <span class="id" title="var">h</span> <span class="id" title="var">b</span>) =&gt; (<span class="id" title="var">hfiber</span> <span class="id" title="var">g</span> <span class="id" title="var">w</span>.1))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> <span class="id" title="var">a</span>; <span class="id" title="var">p</span>) (<span class="id" title="var">a</span> ; 1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">TwoFactorizations</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fact</span> <span class="id" title="var">fact'</span> : <span class="id" title="var">Factorization</span> (@<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span>) (@<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span>) <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Let</span> <span class="id" title="var">H</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">fact_factors</span> <span class="id" title="var">fact</span> <span class="id" title="var">x</span> @ (<span class="id" title="var">fact_factors</span> <span class="id" title="var">fact'</span> <span class="id" title="var">x</span>)^.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.6.5, part 1. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_factor_hfibers</span> (<span class="id" title="var">b</span>:<span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">hfiber</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span>) <span class="id" title="var">b</span> &lt;~&gt; <span class="id" title="var">hfiber</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact'</span>) <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_hfiber_O_fact</span> <span class="id" title="var">fact'</span> <span class="id" title="var">b</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> (<span class="id" title="var">O_hfiber_O_fact</span> <span class="id" title="var">fact</span> <span class="id" title="var">b</span>)^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_hfiber_homotopic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.6.5, part 2. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_factor_hfibers_beta</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_factor_hfibers</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span> <span class="id" title="var">a</span> ; 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (<span class="id" title="var">factor1</span> <span class="id" title="var">fact'</span> <span class="id" title="var">a</span> ; (<span class="id" title="var">H</span> <span class="id" title="var">a</span>)^).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">equiv_O_factor_hfibers</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ev_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_hfiber_O_fact_inverse_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">equiv_fun</span>, <span class="id" title="var">equiv_O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_hfiber_homotopic</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> <span class="id" title="var">o</span> <span class="id" title="var">factor1</span> <span class="id" title="var">fact</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">factor2</span> <span class="id" title="var">fact'</span> <span class="id" title="var">o</span> <span class="id" title="var">factor1</span> <span class="id" title="var">fact'</span>) <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> (<span class="id" title="var">factor1</span> <span class="id" title="var">fact</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">a</span>;1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">path_hints</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">TwoFactorizations</span>.<br/>

<br/>
</div>

<div class="doc">
Theorem 7.6.6.  Recall that a lot of hard work was done in <span class="inlinecode"><span class="id" title="var">Factorization.path_factorization</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_factsys</span> : <span class="id" title="var">FactorizationSystem</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_FactorizationSystem</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">image</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span> <span class="id" title="var">fact</span> <span class="id" title="var">fact'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">Build_PathFactorization</span> <span class="id" title="var">fact</span> <span class="id" title="var">fact'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_fibration_replacement</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="var">equiv_fibration_replacement</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact'</span>))^-1 <span class="id" title="var">oE</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_functor_sigma_id</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_factor_hfibers</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">exact</span> (<span class="id" title="var">pr1_path</span> (<span class="id" title="var">equiv_O_factor_hfibers_beta</span> <span class="id" title="var">f</span> <span class="id" title="var">fact</span> <span class="id" title="var">fact'</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> ((<span class="id" title="var">equiv_O_factor_hfibers</span> <span class="id" title="var">f</span> <span class="id" title="var">fact</span> <span class="id" title="var">fact'</span> (<span class="id" title="var">factor2</span> <span class="id" title="var">fact</span> <span class="id" title="var">x</span>) (<span class="id" title="var">x</span> ; 1)).2 ^).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_pM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="var">inv_V</span> <span class="id" title="var">_</span>)^ @ <span class="id" title="var">_</span> @ <span class="id" title="var">inv_V</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">apply</span> <span class="id" title="var">inverse2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ <span class="id" title="var">pr2_path</span> (<span class="id" title="var">equiv_O_factor_hfibers_beta</span> <span class="id" title="var">f</span> <span class="id" title="var">fact</span> <span class="id" title="var">fact'</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ (<span class="id" title="var">transport_paths_Fl</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)^).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inv_pp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> @ (1 @@ <span class="id" title="var">inv_V</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ModalFact</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>
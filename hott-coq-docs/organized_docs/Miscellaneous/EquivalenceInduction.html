<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>EquivalenceInduction</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library EquivalenceInduction</h1>

<div class="code">
</div>

<div class="doc">
<a id="lab1612"></a><h1 class="section">Equivalence induction</h1>

</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Basics.Overture</span> <span class="id" title="var">Basics.Equivalences</span> <span class="id" title="var">Basics.Tactics</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Types.Equiv</span> <span class="id" title="var">Types.Prod</span> <span class="id" title="var">Types.Forall</span> <span class="id" title="var">Types.Sigma</span> <span class="id" title="var">Types.Universe</span>.<br/>

<br/>
</div>

<div class="doc">
We define typeclasses and tactics for doing equivalence induction. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">equiv_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">RespectsEquivalenceL@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}), (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">k</span>})<br/>
&nbsp;&nbsp;:= <span class="id" title="var">respects_equivalenceL</span> : <span class="id" title="var">sig@</span>{<span class="id" title="var">s0</span> <span class="id" title="var">s1</span>} (<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>), <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>) &lt;~&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Funext</span> -&gt; <span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span> = <span class="id" title="var">e'</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>) ).<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">RespectsEquivalenceR@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span> <span class="id" title="var">s0</span> <span class="id" title="var">s1</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}), (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">k</span>})<br/>
&nbsp;&nbsp;:= <span class="id" title="var">respects_equivalenceR</span> : <span class="id" title="var">sig@</span>{<span class="id" title="var">s0</span> <span class="id" title="var">s1</span>} (<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>), <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>) &lt;~&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Funext</span> -&gt; <span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span> = <span class="id" title="var">e'</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>) ).<br/>
</div>

<div class="doc">
We use a sigma type rather than a record for two reasons:

<div class="paragraph"> </div>

    1. In the dependent cases, where one equivalence-respectfulness proof will show up in the body of another goal, it might be the case that using sigma types allows us to reuse the respectfulness lemmas of sigma types, rather than writing new ones for this type.

<div class="paragraph"> </div>

    2. We expect it to be significantly useful to see the type of the fields than the type of the record, because we expect this type to show up as a goal infrequently.  Sigma types have more informative notations than record type names; the user can run hnf to see what is left to do in the side conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Arguments</span> <span class="id" title="var">RespectsEquivalenceL</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>
<span class="id" title="keyword">Global Arguments</span> <span class="id" title="var">RespectsEquivalenceR</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
</div>

<div class="doc">
When doing equivalence induction, typeclass inference will either fully solve the respectfulness side-conditions, or not make any progress.  We would like to progress as far as we can on the side-conditions, so that we leave the user with as little to prove as possible.  To do this, we create a "database", implemented using typeclasses, to look up the refinement lemma, keyed on the head of the term we want to respect equivalence. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">respects_equivalence_db</span> {<span class="id" title="var">KT</span> <span class="id" title="var">VT</span>} (<span class="id" title="var">Key</span> : <span class="id" title="var">KT</span>) {<span class="id" title="var">lem</span> : <span class="id" title="var">VT</span>} : <span class="id" title="var">Type0</span> := <span class="id" title="var">make_respects_equivalence_db</span> : <span class="id" title="var">Unit</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_lem'</span> {<span class="id" title="var">KT</span> <span class="id" title="var">VT</span>} <span class="id" title="var">Key</span> {<span class="id" title="var">lem</span>} `{@<span class="id" title="var">respects_equivalence_db</span> <span class="id" title="var">KT</span> <span class="id" title="var">VT</span> <span class="id" title="var">Key</span> <span class="id" title="var">lem</span>} : <span class="id" title="var">VT</span> := <span class="id" title="var">lem</span>.<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">get_lem</span> <span class="id" title="var">key</span> := <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">let</span> <span class="id" title="var">res</span> := <span class="id" title="keyword">constr</span>:(<span class="id" title="var">get_lem'</span> <span class="id" title="var">key</span>) <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">res'</span> := (<span class="id" title="tactic">eval</span> <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_lem'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">res</span>) <span class="id" title="tactic">in</span> <span class="id" title="tactic">exact</span> <span class="id" title="var">res'</span>) (<span class="id" title="var">only</span> <span class="id" title="var">parsing</span>).<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">const</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">const_respects_equivalenceL</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">equiv_idmap</span> <span class="id" title="var">T</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">idpath</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">const_respects_equivalenceR</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">idpath</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">const</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span>: <span class="id" title="keyword">forall</span> {<span class="id" title="var">T</span>}, @<span class="id" title="var">respects_equivalence_db</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">A</span> =&gt; @<span class="id" title="var">const_respects_equivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">T</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">tt</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">idmap_respects_equivalenceL</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">e</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">idpath</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">idmap_respects_equivalenceR</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_inverse</span> <span class="id" title="var">e</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">path_equiv</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_forall</span>; <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">id</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">unit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">unit_respects_equivalenceL</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Unit</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= @<span class="id" title="var">const_respects_equivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">Unit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">unit_respects_equivalenceR</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Unit</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= @<span class="id" title="var">const_respects_equivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">Unit</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">unit</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">prod</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">prod_respects_equivalenceL</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>, <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> * <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_functor_prod'</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">fs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transport</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">_</span> = <span class="id" title="var">equiv_functor_prod'</span> <span class="id" title="var">e'</span> <span class="id" title="var">_</span>) (<span class="id" title="var">respects_equivalenceL</span>.2 <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">transport</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">_</span> = <span class="id" title="var">equiv_functor_prod'</span> <span class="id" title="var">_</span> <span class="id" title="var">e'</span>) (<span class="id" title="var">respects_equivalenceL</span>.2 <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">idpath</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">prod_respects_equivalenceR</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>, <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> * <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_functor_prod'</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">fs</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transport</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">_</span> = <span class="id" title="var">equiv_functor_prod'</span> <span class="id" title="var">e'</span> <span class="id" title="var">_</span>) (<span class="id" title="var">respects_equivalenceR</span>.2 <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">transport</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">_</span> = <span class="id" title="var">equiv_functor_prod'</span> <span class="id" title="var">_</span> <span class="id" title="var">e'</span>) (<span class="id" title="var">respects_equivalenceR</span>.2 <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">idpath</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span>: @<span class="id" title="var">respects_equivalence_db</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (@<span class="id" title="var">prod</span>) (@<span class="id" title="var">prod_respects_equivalenceL</span>) := <span class="id" title="var">tt</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">prod</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic to solve the identity-preservation part of equivalence-respectfulness. 
</div>
<div class="code">
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">t_step</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">idtac</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">_</span> = <span class="id" title="var">_</span> :&gt; (<span class="id" title="var">_</span> &lt;~&gt; <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">path_equiv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">intro</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">_</span> = <span class="id" title="var">_</span> :&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">apply</span> <span class="id" title="var">path_forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="tactic">unfold</span> <span class="id" title="var">functor_forall</span>, <span class="id" title="var">functor_sigma</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="keyword">context</span>[?<span class="id" title="var">x</span>.1] ] =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [? <span class="id" title="var">H</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="var">_</span> = <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">A</span> -&gt; ?<span class="id" title="var">B</span>, <span class="id" title="var">H'</span> : ?<span class="id" title="var">A</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">H'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : ?<span class="id" title="var">A</span> -&gt; ?<span class="id" title="var">B</span>, <span class="id" title="var">H'</span> : ?<span class="id" title="var">A</span> |- <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">H</span> <span class="id" title="var">H'</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">eisretr</span>, ?<span class="id" title="var">eissect</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Local Ltac</span> <span class="id" title="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">t_step</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">pi</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">forall_respects_equivalenceL</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>), <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>))}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_functor_forall'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> ((@<span class="id" title="var">respects_equivalenceL</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HP</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="var">eisretr</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">HQ</span> (<span class="id" title="var">equiv_inverse</span> ((@<span class="id" title="var">respects_equivalenceL</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HP</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) <span class="id" title="var">b</span>)).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap10</span> (<span class="id" title="var">ap</span> <span class="id" title="var">equiv_fun</span> (<span class="id" title="var">respects_equivalenceL</span>.2 <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">forall_respects_equivalenceR</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>), <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>))}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_functor_forall'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> ((@<span class="id" title="var">respects_equivalenceR</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HP</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="var">eisretr</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">HQ</span> (<span class="id" title="var">equiv_inverse</span> ((@<span class="id" title="var">respects_equivalenceR</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HP</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) <span class="id" title="var">b</span>)).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap10</span> (<span class="id" title="var">ap</span> <span class="id" title="var">equiv_fun</span> (<span class="id" title="var">respects_equivalenceR</span>.2 <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">pi</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">sigma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">sigma_respects_equivalenceL</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>), <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>))}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">sig</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_functor_sigma'</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">HQ</span> <span class="id" title="var">b</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap10</span> (<span class="id" title="var">ap</span> <span class="id" title="var">equiv_fun</span> (<span class="id" title="var">respects_equivalenceL</span>.2 <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">sigma_respects_equivalenceR</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> : <span class="id" title="var">P</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">A</span>), <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">a</span>))}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">sig</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_functor_sigma'</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">HQ</span> <span class="id" title="var">b</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_path</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">Q</span> <span class="id" title="var">A</span> (<span class="id" title="var">equiv_idmap</span> <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap10</span> (<span class="id" title="var">ap</span> <span class="id" title="var">equiv_fun</span> (<span class="id" title="var">respects_equivalenceR</span>.2 <span class="id" title="var">_</span>)) <span class="id" title="var">_</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span>: @<span class="id" title="var">respects_equivalence_db</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (@<span class="id" title="var">sig</span>) (@<span class="id" title="var">sigma_respects_equivalenceL</span>) := <span class="id" title="var">tt</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">sigma</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">equiv_transfer</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">respects_equivalenceL_equiv</span> {<span class="id" title="var">A</span> <span class="id" title="var">A'</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">P'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, <span class="id" title="var">A'</span> &lt;~&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eA</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> (<span class="id" title="var">equiv_compose'</span> <span class="id" title="var">e</span> <span class="id" title="var">eA</span>) &lt;~&gt; <span class="id" title="var">P'</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A'</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">respects_equivalenceR_equiv</span> {<span class="id" title="var">A</span> <span class="id" title="var">A'</span>} {<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">P'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A'</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eA</span> : <span class="id" title="var">A'</span> &lt;~&gt; <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> (<span class="id" title="var">equiv_compose'</span> <span class="id" title="var">eA</span> <span class="id" title="var">e</span>) &lt;~&gt; <span class="id" title="var">P'</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A'</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">respects_equivalenceL_equiv'</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">P'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> &lt;~&gt; <span class="id" title="var">P'</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">respects_equivalenceR_equiv'</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">P'</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>, <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> &lt;~&gt; <span class="id" title="var">P'</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>); <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_compose'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">HP</span>.1 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">eP</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)))). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">equiv_transfer</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_respects_equivalenceL</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> &lt;~&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_functor_equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">respects_equivalenceL</span>.1. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_respects_equivalenceR</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HQ</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> &lt;~&gt; <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_functor_equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">respects_equivalenceR</span>.1. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span>: @<span class="id" title="var">respects_equivalence_db</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (@<span class="id" title="var">Equiv</span>) (@<span class="id" title="var">equiv_respects_equivalenceL</span>) := <span class="id" title="var">tt</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">equiv</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_ap_respects_equivalenceL</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> = <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">e</span> (<span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) = <span class="id" title="var">e</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_ap'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_ap_inv_respects_equivalenceL</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> = <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) =&gt; <span class="id" title="var">e</span>^-1 (<span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) = <span class="id" title="var">e</span>^-1 (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_ap'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">respects_equivalenceL</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_ap_respects_equivalenceR</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> = <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) =&gt; <span class="id" title="var">e</span> (<span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) = <span class="id" title="var">e</span> (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_ap'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">equiv_ap_inv_respects_equivalenceR</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">B</span>, (<span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">HP</span> : <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) =&gt; <span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> = <span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">RespectsEquivalenceR</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">A</span>) =&gt; <span class="id" title="var">e</span>^-1 (<span class="id" title="var">P</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>) = <span class="id" title="var">e</span>^-1 (<span class="id" title="var">Q</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">_</span>; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_ap'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">respects_equivalenceR</span>.1 <span class="id" title="var">B</span> <span class="id" title="var">e</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">t</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ap</span>.<br/>

<br/>
</div>

<div class="doc">
We now write the tactic that partially solves the respectfulness side-condition.  We include cases for generic typeclass resolution, keys (heads) with zero, one, two, and three arguments, and a few cases that cannot be easily keyed (where the head is one of the arguments, or <span class="inlinecode"><span class="id" title="keyword">forall</span></span>), or the head is <span class="inlinecode"><span class="id" title="var">paths</span></span>, for which we have only ad-hoc solutions at the moment. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">step_respects_equiv</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">idtac</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="tactic">intros</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="tactic">unfold</span> <span class="id" title="var">respects_equivalenceL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">progress</span> <span class="id" title="var">cbn</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span> <span class="comment">(*&nbsp;case&nbsp;for&nbsp;fully&nbsp;solving&nbsp;the&nbsp;side-condition,&nbsp;when&nbsp;possible&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; ?<span class="id" title="var">T</span>) ] =&gt; <span class="id" title="var">rapply</span> (<span class="id" title="var">get_lem</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; ?<span class="id" title="var">T</span> <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="var">rapply</span> (<span class="id" title="var">get_lem</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; ?<span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="var">rapply</span> (<span class="id" title="var">get_lem</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; ?<span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="var">rapply</span> (<span class="id" title="var">get_lem</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_fun</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> = <span class="id" title="var">equiv_fun</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">refine</span> <span class="id" title="var">equiv_ap_respects_equivalenceL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">equiv_inv</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span> = <span class="id" title="var">equiv_inv</span> <span class="id" title="var">e</span> <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">refine</span> <span class="id" title="var">equiv_ap_inv_respects_equivalenceL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">B</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">B</span>) ] =&gt; <span class="id" title="tactic">refine</span> <span class="id" title="var">idmap_respects_equivalenceL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">RespectsEquivalenceL</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">refine</span> <span class="id" title="var">forall_respects_equivalenceL</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">equiv_induction</span> <span class="id" title="var">p</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p'</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">p'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">y</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">type</span> <span class="id" title="keyword">of</span> <span class="id" title="var">p'</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">x</span> &lt;~&gt; ?<span class="id" title="var">y</span> =&gt; <span class="id" title="keyword">constr</span>:(<span class="id" title="var">y</span>) <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">move</span> <span class="id" title="var">p'</span> <span class="id" title="tactic">at</span> <span class="id" title="var">top</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="keyword">forall</span> <span class="id" title="var">y</span> <span class="id" title="var">p</span>, @?<span class="id" title="var">P</span> <span class="id" title="var">y</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="keyword">constr</span>:(<span class="id" title="var">P</span>) <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;use&nbsp;<span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=&gt;</span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode"><span class="id" title="var">_</span></span>&nbsp;to&nbsp;block&nbsp;automatic&nbsp;typeclass&nbsp;resolution&nbsp;in&nbsp;the&nbsp;hole&nbsp;for&nbsp;the&nbsp;equivalence&nbsp;respectful&nbsp;proof.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> <span class="id" title="var">H</span> <span class="id" title="var">B</span> <span class="id" title="var">e</span> =&gt; (@<span class="id" title="var">respects_equivalenceL</span> <span class="id" title="var">_</span> <span class="id" title="var">P</span> <span class="id" title="var">H</span>).1 <span class="id" title="var">B</span> <span class="id" title="var">e</span> <span class="id" title="var">g</span>) <span class="id" title="var">_</span> (<span class="id" title="var">_</span> : (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">x</span>) <span class="id" title="var">_</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">intros</span> | <span class="id" title="tactic">repeat</span> <span class="id" title="var">step_respects_equiv</span> ].<br/>

<br/>
<span class="id" title="keyword">Goal</span> <span class="id" title="keyword">forall</span> `{<span class="id" title="var">Funext</span>} <span class="id" title="var">A</span> <span class="id" title="var">B</span> (<span class="id" title="var">e</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>), <span class="id" title="var">A</span> -&gt; { <span class="id" title="var">y</span> : <span class="id" title="var">B</span> &amp; <span class="id" title="keyword">forall</span> <span class="id" title="var">Q</span>, <span class="id" title="var">Contr</span> <span class="id" title="var">Q</span> -&gt; ((<span class="id" title="var">e</span>^-1 <span class="id" title="var">y</span> = <span class="id" title="var">e</span>^-1 <span class="id" title="var">y</span>) &lt;~&gt; (<span class="id" title="var">y</span> = <span class="id" title="var">y</span>)) * <span class="id" title="var">Q</span> }.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? ? ? <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">equiv_induction</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (1, <span class="id" title="var">center</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Abort</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>
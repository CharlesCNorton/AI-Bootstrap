<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Decidable</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Decidable</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Basics.Overture</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Basics.PathGroupoids</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Basics.Trunc</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Basics.Tactics</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Basics.Iff</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">trunc_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">path_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab321"></a><h1 class="section">Decidability</h1>

<div class="paragraph"> </div>

<a id="lab322"></a><h2 class="section">Definitions</h2>

</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;NB:&nbsp;This&nbsp;has&nbsp;to&nbsp;come&nbsp;after&nbsp;our&nbsp;definition&nbsp;of&nbsp;<span class="inlinecode"><span class="id" title="var">not</span></span>&nbsp;(which&nbsp;is&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">Overture</span></span>),&nbsp;so&nbsp;that&nbsp;it&nbsp;refers&nbsp;to&nbsp;our&nbsp;<span class="inlinecode"><span class="id" title="var">not</span></span>&nbsp;rather&nbsp;than&nbsp;the&nbsp;one&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">Coq.Logic</span></span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">Decidable</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">dec</span> : <span class="id" title="var">A</span> + (~ <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">dec</span> <span class="id" title="var">A</span> {<span class="id" title="var">_</span>}.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">decide_type</span></span> and <span class="inlinecode"><span class="id" title="var">decide</span></span> tactic allow to automatically prove
decidable claims using previously written decision procedures that
compute. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">decide_type</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">K</span> := (<span class="id" title="tactic">eval</span> <span class="id" title="tactic">hnf</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">dec</span> <span class="id" title="var">A</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">K</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">inl</span> ?<span class="id" title="var">Z</span> =&gt; <span class="id" title="tactic">exact</span> <span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">inr</span> ?<span class="id" title="var">Z</span> =&gt; <span class="id" title="tactic">exact</span> <span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">decide</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">multimatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [|- ?<span class="id" title="var">A</span>] =&gt; <span class="id" title="var">decide_type</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;| [|- ~ ?<span class="id" title="var">A</span>] =&gt; <span class="id" title="var">decide_type</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_true</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">p</span> : <span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>), <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">P</span> (<span class="id" title="var">inl</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>, <span class="id" title="var">P</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">x</span>|<span class="id" title="var">n</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">contradiction</span> <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Replace a term <span class="inlinecode"><span class="id" title="var">p</span></span> of the form <span class="inlinecode"><span class="id" title="var">Decidable</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> with <span class="inlinecode"><span class="id" title="var">inl</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> if we have a term <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">A</span></span> showing that <span class="inlinecode"><span class="id" title="var">A</span></span> is true. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">decidable_true</span> <span class="id" title="var">p</span> <span class="id" title="var">a</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">decidable_true</span> <span class="id" title="var">a</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">intro</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_false</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">n</span> : <span class="id" title="var">not</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">p</span> : <span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>), <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">n'</span>, <span class="id" title="var">P</span> (<span class="id" title="var">inr</span> <span class="id" title="var">n'</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>, <span class="id" title="var">P</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">x</span>|<span class="id" title="var">n'</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="var">contradiction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Replace a term <span class="inlinecode"><span class="id" title="var">p</span></span> of the form <span class="inlinecode"><span class="id" title="var">Decidable</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> with <span class="inlinecode"><span class="id" title="var">inr</span></span> <span class="inlinecode"><span class="id" title="var">na</span></span> if we have a term <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">not</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> showing that <span class="inlinecode"><span class="id" title="var">A</span></span> is false. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">decidable_false</span> <span class="id" title="var">p</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">decidable_false</span> <span class="id" title="var">n</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">intro</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">DecidablePaths</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">dec_paths</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">A</span>), <span class="id" title="var">Decidable</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>).<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">dec_paths</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">Stable</span> <span class="id" title="var">P</span> := <span class="id" title="var">stable</span> : ~~<span class="id" title="var">P</span> -&gt; <span class="id" title="var">P</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">stable_decidable</span> <span class="id" title="var">P</span> `{!<span class="id" title="var">Decidable</span> <span class="id" title="var">P</span>} : <span class="id" title="var">Stable</span> <span class="id" title="var">P</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">dn</span>;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> <span class="id" title="var">P</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span>|<span class="id" title="var">n</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Empty_rect</span>,<span class="id" title="var">dn</span>,<span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">stable_negation</span> <span class="id" title="var">P</span> : <span class="id" title="var">Stable</span> (~ <span class="id" title="var">P</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">nnnp</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">nnnp</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">np</span> =&gt; <span class="id" title="var">np</span> <span class="id" title="var">p</span>)).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iff_stable</span> <span class="id" title="var">P</span> `(<span class="id" title="var">Stable</span> <span class="id" title="var">P</span>) : ~~<span class="id" title="var">P</span> &lt;-&gt; <span class="id" title="var">P</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">stable</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
  Because <span class="inlinecode"><span class="id" title="keyword">vm_compute</span></span> evaluates terms in <span class="inlinecode"><span class="id" title="var">PROP</span></span> eagerly
  and does not remove dead code we
  need the decide_rel hack. Suppose we have <span class="inlinecode">(<span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">y</span>)</span> <span class="inlinecode">=<span class="id" title="var">def</span></span>  <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">y</span>)</span>, now:
     bool_decide (x = y) -&gt; bool_decide (f x = f y) -&gt; ...
  As we see, the dead code <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> and <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> is actually evaluated,
  which is of course an utter waste.
  Therefore we introduce decide_rel and bool_decide_rel.
     bool_decide_rel (=) x y -&gt; bool_decide_rel (fun a b =&gt; f a = f b) x y -&gt; ...
  Now the definition of equality remains under a lambda and
  our problem does not occur anymore!

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decide_rel</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;{<span class="id" title="var">dec</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">Decidable</span> (<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">y</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">Decidable</span> (<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab323"></a><h2 class="section">Decidable hprops</h2>

<div class="paragraph"> </div>

 Contractible types are decidable. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">decidable_contr</span> <span class="id" title="var">X</span> `{<span class="id" title="var">Contr</span> <span class="id" title="var">X</span>} : <span class="id" title="var">Decidable</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">inl</span> (<span class="id" title="var">center</span> <span class="id" title="var">X</span>).<br/>

<br/>
</div>

<div class="doc">
Thus, hprops have decidable equality. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">decidablepaths_hprop</span> <span class="id" title="var">X</span> `{<span class="id" title="var">IsHProp</span> <span class="id" title="var">X</span>} : <span class="id" title="var">DecidablePaths</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">dec</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>).<br/>

<br/>
</div>

<div class="doc">
Empty types are trivial. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">decidable_empty</span> : <span class="id" title="var">Decidable</span> <span class="id" title="var">Empty</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">inr</span> <span class="id" title="var">idmap</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab324"></a><h2 class="section">Transfer along equivalences</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_iff</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;-&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">Decidable</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Decidable</span> <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span>|<span class="id" title="var">na</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inl</span> (<span class="id" title="var">fst</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inr</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">na</span> (<span class="id" title="var">snd</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>))).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_equiv'</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
: <span class="id" title="var">Decidable</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Decidable</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">decidable_iff</span> <span class="id" title="var">f</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_equiv</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{!<span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>}<br/>
: <span class="id" title="var">Decidable</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Decidable</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">decidable_equiv'</span> <span class="id" title="var">_</span> (<span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidablepaths_equiv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>}<br/>
: <span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">DecidablePaths</span> <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">d</span> (<span class="id" title="var">f</span>^-1 <span class="id" title="var">x</span>) (<span class="id" title="var">f</span>^-1 <span class="id" title="var">y</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">e</span>|<span class="id" title="var">ne</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">inl</span>. <span class="id" title="tactic">exact</span> ((<span class="id" title="var">eisretr</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>)^ @ <span class="id" title="var">ap</span> <span class="id" title="var">f</span> <span class="id" title="var">e</span> @ <span class="id" title="var">eisretr</span> <span class="id" title="var">f</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">inr</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ne</span>, <span class="id" title="var">ap</span>, <span class="id" title="var">p</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidablepaths_equiv'</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
: <span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">DecidablePaths</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">decidablepaths_equiv</span> <span class="id" title="var">A</span> <span class="id" title="var">f</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab325"></a><h2 class="section">Hedberg's theorem: any type with decidable equality is a set.</h2>

<div class="paragraph"> </div>

 A weakly constant function is one all of whose values are equal (in a specified way). 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">WeaklyConstant</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wconst</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">f</span> <span class="id" title="var">x</span> = <span class="id" title="var">f</span> <span class="id" title="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
Any map that factors through an hprop is weakly constant. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">wconst_through_hprop</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">P</span>} `{<span class="id" title="var">IsHProp</span> <span class="id" title="var">P</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">P</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">P</span> -&gt; <span class="id" title="var">B</span>)<br/>
: <span class="id" title="var">WeaklyConstant</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> (<span class="id" title="var">ap</span> <span class="id" title="var">g</span>), <span class="id" title="var">path_ishprop</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A type is collapsible if it admits a weakly constant endomap. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">Collapsible</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id" title="var">collapse</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wconst_collapse</span> : <span class="id" title="var">WeaklyConstant</span> <span class="id" title="var">collapse</span><br/>
&nbsp;&nbsp;}.<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">wconst_collapse</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">PathCollapsible</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">path_coll</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">A</span>), <span class="id" title="var">Collapsible</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>).<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">path_coll</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">collapsible_decidable</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">Collapsible</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> <span class="id" title="var">A</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">a</span> | <span class="id" title="var">na</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> (<span class="id" title="var">const</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> <span class="id" title="var">idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">destruct</span> (<span class="id" title="var">na</span> <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">pathcoll_decpaths</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">PathCollapsible</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We give this a relatively high-numbered priority so that in deducing <span class="inlinecode"><span class="id" title="var">IsHProp</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">IsHSet</span></span> Coq doesn't detour via <span class="inlinecode"><span class="id" title="var">DecidablePaths</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hset_pathcoll</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">PathCollapsible</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">IsHSet</span> <span class="id" title="var">A</span> | 1000.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">istrunc_S</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">h</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>:<span class="id" title="var">x</span>=<span class="id" title="var">y</span>, <span class="id" title="var">p</span> = (<span class="id" title="var">collapse</span> (<span class="id" title="var">idpath</span> <span class="id" title="var">x</span>))^ @ <span class="id" title="var">collapse</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> []; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">concat_Vp</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hprop_allpath</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">h</span> <span class="id" title="var">p</span> @ <span class="id" title="var">_</span> @ (<span class="id" title="var">h</span> <span class="id" title="var">q</span>)^).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">whiskerL</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wconst</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">collapsible_hprop</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">IsHProp</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">Collapsible</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">idmap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">path_ishprop</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pathcoll_hset</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">IsHSet</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">PathCollapsible</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">collapsible_hprop</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Hedberg's Theorem 
</div>
<div class="code">
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">hset_decpaths</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span>}<br/>
: <span class="id" title="var">IsHSet</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We can use Hedberg's Theorem to simplify a goal of the form <span class="inlinecode"><span class="id" title="keyword">forall</span></span> <span class="inlinecode">(<span class="id" title="var">d</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Decidable</span></span> <span class="inlinecode">(<span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">:&gt;</span> <span class="inlinecode"><span class="id" title="var">A</span>)),</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> when <span class="inlinecode"><span class="id" title="var">A</span></span> has decidable paths. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">decidable_paths_refl</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">x</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">d</span> : <span class="id" title="var">Decidable</span> (<span class="id" title="var">x</span> = <span class="id" title="var">x</span>)), <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">Px</span> : <span class="id" title="var">P</span> (<span class="id" title="var">inl</span> <span class="id" title="var">idpath</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">d</span>, <span class="id" title="var">P</span> <span class="id" title="var">d</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">decidable_true</span> <span class="id" title="var">idpath</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">p</span>.<br/>
</div>

<div class="doc">
We cannot eliminate <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">x</span></span> with path induction, but we can use Hedberg's theorem to replace this with <span class="inlinecode"><span class="id" title="var">idpath</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">r</span> : (<span class="id" title="var">idpath</span> = <span class="id" title="var">p</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">path_ishprop</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">r</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab326"></a><h2 class="section">Truncation</h2>

<div class="paragraph"> </div>

 Having decidable equality (which implies being an hset, by Hedberg's theorem above) is itself an hprop. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ishprop_decpaths</span> `{<span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
: <span class="id" title="var">IsHProp</span> (<span class="id" title="var">DecidablePaths</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hprop_inhabited_contr</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">IsHSet</span> <span class="id" title="var">A</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Build_Contr</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">d'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funext</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">d</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">d</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">d'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>); <span class="id" title="tactic">clear</span> <span class="id" title="var">d'</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">d'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span>|<span class="id" title="var">nd</span>]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">d'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">d'</span>|<span class="id" title="var">nd'</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">path_ishprop</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">elim</span> (<span class="id" title="var">nd'</span> <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">elim</span> (<span class="id" title="var">nd</span> <span class="id" title="var">d'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">path_forall</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">elim</span> (<span class="id" title="var">nd</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab327"></a><h2 class="section">Logical Laws</h2>

<div class="paragraph"> </div>

 Various logical laws don't hold constructively as they do classically due to a required use of excluded middle. For us, this means that some laws require further assumptions on the decidability of propositions. 
<div class="paragraph"> </div>

 Here we give the dual De Morgan's Law which complements the one given in Iff.v.  One direction requires that one of the two propositions be decidable, while the other direction needs no assumption.  We state the latter property first, to avoid duplication in the proof. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">not_prod_sum_not</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> : ~ <span class="id" title="var">A</span> + ~ <span class="id" title="var">B</span> -&gt; ~ (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">na</span>|<span class="id" title="var">nb</span>] [<span class="id" title="var">a</span> <span class="id" title="var">b</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">na</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">nb</span> <span class="id" title="var">b</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iff_not_prod</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> `{<span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: ~ (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>) &lt;-&gt; ~ <span class="id" title="var">A</span> + ~ <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">np</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> <span class="id" title="var">A</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">a</span>|<span class="id" title="var">na</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">inr</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">np</span> (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">inl</span> <span class="id" title="var">na</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">not_prod_sum_not</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iff_not_prod'</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> `{<span class="id" title="var">Decidable</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;: ~ (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>) &lt;-&gt; ~ <span class="id" title="var">A</span> + ~ <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">np</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> <span class="id" title="var">B</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">b</span>|<span class="id" title="var">nb</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">inl</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">np</span> (<span class="id" title="var">a</span>, <span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">inr</span> <span class="id" title="var">nb</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">not_prod_sum_not</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>
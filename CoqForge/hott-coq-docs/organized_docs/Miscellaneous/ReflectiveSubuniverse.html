<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>ReflectiveSubuniverse</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library ReflectiveSubuniverse</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">HoTT.Basics</span> <span class="id" title="var">HoTT.Types</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Equiv.BiInv</span> <span class="id" title="var">Extensions</span> <span class="id" title="var">HProp</span> <span class="id" title="var">HFiber</span> <span class="id" title="var">NullHomotopy</span> <span class="id" title="var">Limits.Pullback</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PathAny</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Colimits.Pushout</span>.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">nat_scope</span>.<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">path_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1248"></a><h1 class="section">Reflective Subuniverses</h1>

<div class="paragraph"> </div>

<a id="lab1249"></a><h2 class="section">References</h2>

<div class="paragraph"> </div>

 Reflective subuniverses (and modalities) are studied in the following papers, which we will refer to below by their abbreviations:

<div class="paragraph"> </div>

<ul class="doclist">
<li> The Book: The Homotopy Type Theory Book, chapter 7.  Bare references to "Theorem 7.x.x" are always to the Book.

</li>
<li> RSS: Rijke, Spitters, and Shulman, "Modalities in homotopy type theory", https://arxiv.org/abs/1706.07526.

</li>
<li> CORS: Christensen, Opie, Rijke, and Scoccola, "Localization in Homotopy Type Theory", https://arxiv.org/abs/1807.04155.

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab1250"></a><h2 class="section">Definitions</h2>

<div class="paragraph"> </div>

<a id="lab1251"></a><h3 class="section">Subuniverses</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Record</span> <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">In_internal</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} -&gt; <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} ;<br/>
&nbsp;&nbsp;<span class="id" title="var">hprop_inO_internal</span> : <span class="id" title="var">Funext</span> -&gt; <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">IsHProp</span> (<span class="id" title="var">In_internal</span> <span class="id" title="var">T</span>) ;<br/>
&nbsp;&nbsp;<span class="id" title="var">inO_equiv_inO_internal</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> <span class="id" title="var">U</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">T_inO</span> : <span class="id" title="var">In_internal</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">U</span>) {<span class="id" title="var">feq</span> : <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">In_internal</span> <span class="id" title="var">U</span> ;<br/>
}.<br/>

<br/>
</div>

<div class="doc">
Work around Coq bug that fields of records can't be typeclasses. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">In</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) := <span class="id" title="var">in_internal</span> : <span class="id" title="var">In_internal</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>.<br/>

<br/>
</div>

<div class="doc">
Being in the subuniverse is a mere predicate (by hypothesis).  We include funext in the hypotheses of hprop_inO so that it doesn't have to be assumed in all definitions of (reflective) subuniverses, since in most examples it is required for this and this only.  Here we redefine it using the replaced <span class="inlinecode"><span class="id" title="var">In</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hprop_inO</span> `{<span class="id" title="var">Funext</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsHProp</span> (<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;:= @<span class="id" title="var">hprop_inO_internal</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span>.<br/>

<br/>
</div>

<div class="doc">
We assumed repleteness of the subuniverse in the definition.  Of course, with univalence this would be automatic, but we include it as a hypothesis since most of the theory of reflective subuniverses and modalities doesn't need univalence, and most or all examples can be shown to be replete without using univalence.  Here we redefine it using the replaced <span class="inlinecode"><span class="id" title="var">In</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_equiv_inO</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">U</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">T_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">U</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;:= @<span class="id" title="var">inO_equiv_inO_internal</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> <span class="id" title="var">T_inO</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_equiv_inO'</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">U</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> &lt;~&gt; <span class="id" title="var">U</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">T</span> <span class="id" title="var">f</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">iff_inO_equiv</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">U</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> &lt;~&gt; <span class="id" title="var">U</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;:= (<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">inO_equiv_inO'</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>, <span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> =&gt; <span class="id" title="var">inO_equiv_inO'</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>^-1).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_inO_equiv</span> `{<span class="id" title="var">Funext</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">U</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> &lt;~&gt; <span class="id" title="var">U</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> &lt;~&gt; <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">U</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">equiv_iff_hprop_uncurried</span> (<span class="id" title="var">iff_inO_equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
The universe of types in the subuniverse 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Type_@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}) : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}<br/>
&nbsp;&nbsp;:= @<span class="id" title="var">sig@</span>{<span class="id" title="var">j</span> <span class="id" title="var">i</span>} <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} (<span class="id" title="keyword">fun</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) =&gt; <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>).<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">TypeO_pr1</span> <span class="id" title="var">O</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type_</span> <span class="id" title="var">O</span>) := @<span class="id" title="var">pr1</span> <span class="id" title="keyword">Type</span> (<span class="id" title="var">In</span> <span class="id" title="var">O</span>) <span class="id" title="var">T</span>.<br/>

<br/>
</div>

<div class="doc">
The second component of <span class="inlinecode"><span class="id" title="var">TypeO</span></span> is unique.  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">path_TypeO@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span>} {<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} <span class="id" title="var">O</span> (<span class="id" title="var">T</span> <span class="id" title="var">T'</span> : <span class="id" title="var">Type_@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span>} <span class="id" title="var">O</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">T</span>.1 = <span class="id" title="var">T'</span>.1)<br/>
&nbsp;&nbsp;: <span class="id" title="var">T</span> = <span class="id" title="var">T'</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">path_sigma_hprop@</span>{<span class="id" title="var">j</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>} <span class="id" title="var">T</span> <span class="id" title="var">T'</span> <span class="id" title="var">p</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_path_TypeO@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span>} {<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} <span class="id" title="var">O</span> (<span class="id" title="var">T</span> <span class="id" title="var">T'</span> : <span class="id" title="var">Type_@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span>} <span class="id" title="var">O</span>)<br/>
&nbsp;&nbsp;: (<span class="id" title="var">paths@</span>{<span class="id" title="var">j</span>} <span class="id" title="var">T</span>.1 <span class="id" title="var">T'</span>.1) &lt;~&gt; (<span class="id" title="var">T</span> = <span class="id" title="var">T'</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">equiv_path_sigma_hprop@</span>{<span class="id" title="var">j</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>} <span class="id" title="var">T</span> <span class="id" title="var">T'</span>.<br/>

<br/>
</div>

<div class="doc">
Types in <span class="inlinecode"><span class="id" title="var">TypeO</span></span> are always in <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_TypeO</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">Type_</span> <span class="id" title="var">O</span>) : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">A</span>.2.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1252"></a><h2 class="section">Properties of Subuniverses</h2>

<div class="paragraph"> </div>

 A map is O-local if all its fibers are. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">MapIn</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">inO_hfiber_ino_map</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">b</span>:<span class="id" title="var">B</span>), <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>).<br/>

<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">inO_hfiber_ino_map</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Subuniverse</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>).<br/>

<br/>
</div>

<div class="doc">
Being a local map is an hprop 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ishprop_mapinO</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsHProp</span> (<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">istrunc_forall</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Anything homotopic to a local map is local. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapinO_homotopic</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) {<span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>) `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_hfiber_homotopic</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">p</span> <span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The projection from a family of local types is local. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_pr1</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (@<span class="id" title="var">pr1</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>) (<span class="id" title="var">hfiber_fibration</span> <span class="id" title="var">a</span> <span class="id" title="var">B</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A family of types is local if and only if the associated projection map is local. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">iff_forall_inO_mapinO_pr1</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)) &lt;-&gt; <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (@<span class="id" title="var">pr1</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>. <span class="comment">(*&nbsp;Uses&nbsp;the&nbsp;instance&nbsp;mapinO_pr1&nbsp;above.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">rapply</span> <span class="id" title="var">functor_forall</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">pr1</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">hfiber_fibration</span> <span class="id" title="var">a</span> <span class="id" title="var">B</span>)^-1%<span class="id" title="var">equiv</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">equiv_forall_inO_mapinO_pr1</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)) &lt;~&gt; <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (@<span class="id" title="var">pr1</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">equiv_iff_hprop_uncurried</span> (<span class="id" title="var">iff_forall_inO_mapinO_pr1</span> <span class="id" title="var">B</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Subuniverse</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1253"></a><h3 class="section">Reflections</h3>

<div class="paragraph"> </div>

 A pre-reflection is a map to a type in the subuniverse. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">PreReflects@</span>{<span class="id" title="var">i</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">O_reflector</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>} ;<br/>
&nbsp;&nbsp;<span class="id" title="var">O_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">O_reflector</span> ;<br/>
&nbsp;&nbsp;<span class="id" title="var">to</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">O_reflector</span> ;<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> {<span class="id" title="var">_</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> {<span class="id" title="var">_</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_inO</span> {<span class="id" title="var">O</span>} <span class="id" title="var">T</span> {<span class="id" title="var">_</span>}.<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">O_inO</span>.<br/>

<br/>
</div>

<div class="doc">
It is a reflection if it has the requisite universal property. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">Reflects@</span>{<span class="id" title="var">i</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">PreReflects@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">O</span> <span class="id" title="var">T</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">extendable_to_O</span> : <span class="id" title="keyword">forall</span> {<span class="id" title="var">Q</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} {<span class="id" title="var">Q_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Q</span>)<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> {<span class="id" title="var">T</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q_inO</span>}.<br/>

<br/>
</div>

<div class="doc">
Here's a modified version that applies to types in possibly-smaller universes without collapsing those universes to <span class="inlinecode"><span class="id" title="var">i</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">extendable_to_O'@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span> | <span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>, <span class="id" title="var">k</span> &lt;= <span class="id" title="var">i</span>} (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">Reflects</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} {<span class="id" title="var">Q</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">k</span>}} {<span class="id" title="var">Q_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">lift_ooextendablealong</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">extendable_to_O</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, every type in the subuniverse automatically reflects into it. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">prereflects_in</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} : <span class="id" title="var">PreReflects</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">idmap</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflects_in</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} : @<span class="id" title="var">Reflects</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> (<span class="id" title="var">prereflects_in</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_equiv</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A reflective subuniverse is one for which every type reflects into it. 
</div>
<div class="code">
<span class="id" title="keyword">Record</span> <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i</span>} :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">rsu_subuniv</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i</span>} ;<br/>
&nbsp;&nbsp;<span class="id" title="var">rsu_prereflects</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}), <span class="id" title="var">PreReflects</span> <span class="id" title="var">rsu_subuniv</span> <span class="id" title="var">T</span> ;<br/>
&nbsp;&nbsp;<span class="id" title="var">rsu_reflects</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">T</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}), <span class="id" title="var">Reflects</span> <span class="id" title="var">rsu_subuniv</span> <span class="id" title="var">T</span> ;<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">rsu_subuniv</span> : <span class="id" title="var">ReflectiveSubuniverse</span> &gt;-&gt; <span class="id" title="var">Subuniverse</span>.<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">rsu_prereflects</span>.<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">rsu_reflects</span>.<br/>

<br/>
</div>

<div class="doc">
We allow the name of a subuniverse or modality to be used as the name of its reflector.  This means that when defining a particular example, you should generally put the parametrizing family in a wrapper, so that you can notate the subuniverse as parametrized by, rather than identical to, its parameter.  See Modality.v, Truncations.v, and Localization.v for examples. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">rsu_reflector</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>.<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">rsu_reflector</span> : <span class="id" title="var">ReflectiveSubuniverse</span> &gt;-&gt; <span class="id" title="var">Funclass</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1254"></a><h3 class="section">Recursion principles</h3>

<div class="paragraph"> </div>

 We now extract the recursion principle and the restricted induction principles for paths. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">ORecursion</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>} `{<span class="id" title="var">Reflects</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec</span> (<span class="id" title="var">f</span> : <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">f</span>).1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec_beta</span> (<span class="id" title="var">f</span> : <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_rec</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span>) = <span class="id" title="var">f</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">f</span>).2 <span class="id" title="var">x</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_indpaths</span> (<span class="id" title="var">g</span> <span class="id" title="var">h</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> == <span class="id" title="var">h</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">g</span> == <span class="id" title="var">h</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 2) <span class="id" title="var">g</span> <span class="id" title="var">h</span>) <span class="id" title="var">p</span>).1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_indpaths_beta</span> (<span class="id" title="var">g</span> <span class="id" title="var">h</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">g</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>) == <span class="id" title="var">h</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_indpaths</span> <span class="id" title="var">g</span> <span class="id" title="var">h</span> <span class="id" title="var">p</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span>) = <span class="id" title="var">p</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 2) <span class="id" title="var">g</span> <span class="id" title="var">h</span>) <span class="id" title="var">p</span>).2 <span class="id" title="var">x</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_ind2paths</span> {<span class="id" title="var">g</span> <span class="id" title="var">h</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>} (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">g</span> == <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">r</span> : <span class="id" title="var">p</span> <span class="id" title="var">oD</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>) == <span class="id" title="var">q</span> <span class="id" title="var">oD</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">p</span> == <span class="id" title="var">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 3) <span class="id" title="var">g</span> <span class="id" title="var">h</span>) <span class="id" title="var">p</span> <span class="id" title="var">q</span>) <span class="id" title="var">r</span>).1.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_ind2paths_beta</span> {<span class="id" title="var">g</span> <span class="id" title="var">h</span> : <span class="id" title="var">O_reflector</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>} (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">g</span> == <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">r</span> : <span class="id" title="var">p</span> <span class="id" title="var">oD</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>) == <span class="id" title="var">q</span> <span class="id" title="var">oD</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>)) (<span class="id" title="var">x</span> : <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_ind2paths</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span>) = <span class="id" title="var">r</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span> 3) <span class="id" title="var">g</span> <span class="id" title="var">h</span>) <span class="id" title="var">p</span> <span class="id" title="var">q</span>) <span class="id" title="var">r</span>).2 <span class="id" title="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
Clearly we can continue indefinitely as needed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ORecursion</span>.<br/>

<br/>
<span class="comment">(*&nbsp;We&nbsp;never&nbsp;want&nbsp;to&nbsp;see&nbsp;<span class="inlinecode"><span class="id" title="var">extendable_to_O</span></span>.&nbsp;&nbsp;The&nbsp;<span class="inlinecode">!<span class="id" title="var">x</span></span>&nbsp;allows&nbsp;<span class="inlinecode"><span class="id" title="var">cbn</span></span>&nbsp;to&nbsp;unfold&nbsp;these&nbsp;when&nbsp;passed&nbsp;a&nbsp;constructor,&nbsp;such&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>.&nbsp;&nbsp;This,&nbsp;for&nbsp;example,&nbsp;means&nbsp;that&nbsp;<span class="inlinecode"><span class="id" title="var">O_rec</span></span> <span class="inlinecode">(<span class="id" title="var">O</span>:=<span class="id" title="var">Tr</span></span> <span class="inlinecode"><span class="id" title="var">n</span>)</span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span>&nbsp;will&nbsp;compute&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">Trunc_functor</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">(<span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span>&nbsp;will&nbsp;compute&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode">(<span class="id" title="var">f</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span>.&nbsp;*)</span><br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_rec</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} <span class="id" title="var">f</span>%<span class="id" title="var">_function_scope</span> !<span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_rec_beta</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} <span class="id" title="var">f</span>%<span class="id" title="var">_function_scope</span> !<span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_indpaths</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} (<span class="id" title="var">g</span> <span class="id" title="var">h</span>)%<span class="id" title="var">_function_scope</span> <span class="id" title="var">p</span> !<span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_indpaths_beta</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} (<span class="id" title="var">g</span> <span class="id" title="var">h</span>)%<span class="id" title="var">_function_scope</span> <span class="id" title="var">p</span> !<span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_ind2paths</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} {<span class="id" title="var">g</span> <span class="id" title="var">h</span>}%<span class="id" title="var">_function_scope</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> !<span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">O_ind2paths_beta</span> {<span class="id" title="var">O</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span>}%<span class="id" title="var">_type_scope</span> {<span class="id" title="var">Q_inO</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>} {<span class="id" title="var">g</span> <span class="id" title="var">h</span>}%<span class="id" title="var">_function_scope</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> <span class="id" title="var">r</span> !<span class="id" title="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
A tactic that generalizes <span class="inlinecode"><span class="id" title="var">strip_truncations</span></span> to reflective subuniverses. <span class="inlinecode"><span class="id" title="var">strip_truncations</span></span> introduces fewer universe variables, so tends to work better when removing truncations. <span class="inlinecode"><span class="id" title="var">strip_modalities</span></span> in Modality.v also applies dependent elimination when <span class="inlinecode"><span class="id" title="var">O</span></span> is a modality. 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">strip_reflections</span> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc">
Search for hypotheses of type <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> for some <span class="inlinecode"><span class="id" title="var">O</span></span> such that the goal is <span class="inlinecode"><span class="id" title="var">O</span></span>-local. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">progress</span> <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">T</span> : <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id" title="var">revert_opaque</span> <span class="id" title="var">T</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (@<span class="id" title="var">O_rec</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) || <span class="id" title="tactic">refine</span> (@<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Ensure that we didn't generate more than one subgoal, i.e. that the goal was appropriately local. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Given <span class="inlinecode"><span class="id" title="var">Funext</span></span>, we prove the definition of reflective subuniverse in the book. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_o_to_O</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>}<br/>
: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> : <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>)<br/>
:= <span class="id" title="var">isequiv_ooextendable</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_o_to_O</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>}<br/>
: (<span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>) &lt;~&gt; (<span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>)<br/>
:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> : <span class="id" title="var">O</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span>) <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">isequiv_ooextendable</span></span> is defined in a way that makes <span class="inlinecode"><span class="id" title="var">O_rec</span></span> definitionally equal to the inverse of <span class="inlinecode"><span class="id" title="var">equiv_o_to_O</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_O_rec_to_O</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> : <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">O_rec</span> <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;:= (<span class="id" title="var">equiv_isequiv</span> (<span class="id" title="var">equiv_o_to_O</span> <span class="id" title="var">O</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>)^-1).<br/>

<br/>
</div>

<div class="doc">
<a id="lab1255"></a><h2 class="section">Properties of Reflective Subuniverses</h2>

<div class="paragraph"> </div>

 We now prove a bunch of things about an arbitrary reflective subuniverse. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">Reflective_Subuniverse</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>).<br/>

<br/>
</div>

<div class="doc">
Functoriality of <span class="inlinecode"><span class="id" title="var">O_rec</span></span> homotopies 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec_homotopy</span> {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Q</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>) (<span class="id" title="var">pi</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) <span class="id" title="var">f</span> == <span class="id" title="var">O_rec</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">etransitivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">etransitivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">exact</span> (<span class="id" title="var">pi</span> <span class="id" title="var">_</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>. } }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">T</span></span> is in the subuniverse, then <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> is an equivalence. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_to_O_inO</span> (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} : <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">g</span> := <span class="id" title="var">O_rec</span> <span class="id" title="var">idmap</span> : <span class="id" title="var">O</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) <span class="id" title="var">g</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span>) <span class="id" title="var">idmap</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_to_O</span> (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>} : <span class="id" title="var">T</span> &lt;~&gt; <span class="id" title="var">O</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">T</span> (<span class="id" title="var">O</span> <span class="id" title="var">T</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) <span class="id" title="var">_</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Functor</span>.<br/>

<br/>
</div>

<div class="doc">
In this section, we see that <span class="inlinecode"><span class="id" title="var">O</span></span> is a functor. 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) : <span class="id" title="var">O</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">O_rec</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
Naturality of <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">to_O_natural</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) == (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">o</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">_</span>).<br/>

<br/>
</div>

<div class="doc">
Functoriality on composition 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_compose</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">O_functor</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)) == (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>) <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">exact</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>; <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Functoriality on homotopies (2-functoriality) 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_homotopy</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">pi</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> == <span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span>)^).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">pi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Functoriality for inverses of homotopies 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_homotopy_V</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">pi</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">g</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">pi</span> <span class="id" title="var">x</span>)^)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">pi</span> <span class="id" title="var">x</span>)^.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind2paths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">composeD</span>, <span class="id" title="var">O_functor_homotopy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">O_indpaths_beta</span>, !<span class="id" title="var">ap_V</span>, !<span class="id" title="var">inv_pp</span>, <span class="id" title="var">inv_V</span>, !<span class="id" title="var">concat_p_pp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Hence functoriality on commutative squares 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_square</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">pi1</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">pi2</span> : <span class="id" title="var">X</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">comm</span> : (<span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">pi1</span>) == (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">pi2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: ( (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">pi1</span>) )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== ( (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>) <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">pi2</span>) ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">O_functor</span> (<span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">pi1</span>) <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">O_functor_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">transitivity</span> (<span class="id" title="var">O_functor</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">pi2</span>) <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor_homotopy</span>, <span class="id" title="var">comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">rapply</span> <span class="id" title="var">O_functor_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Functoriality on identities 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_idmap</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: @<span class="id" title="var">O_functor</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span> <span class="id" title="var">idmap</span> == <span class="id" title="var">idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
3-functoriality, as an example use of <span class="inlinecode"><span class="id" title="var">O_ind2paths</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_2homotopy</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">p</span> == <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">p</span> == <span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind2paths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor_homotopy</span>, <span class="id" title="var">composeD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_indpaths_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">whiskerL</span>, <span class="id" title="var">whiskerR</span>, <span class="id" title="var">ap</span>, <span class="id" title="var">r</span>.<br/>
</div>

<div class="doc">
Of course, if we wanted to prove 4-functoriality, we'd need to make this transparent. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
2-naturality: Functoriality on homotopies is also natural 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_homotopy_beta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">pi</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">pi</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">ap</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) (<span class="id" title="var">pi</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span>)^.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor_homotopy</span>, <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths_beta</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">concat_p_pp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The pointed endofunctor (<span class="inlinecode"><span class="id" title="var">O</span></span>,<span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>) is well-pointed 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_wellpointed</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) == <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
"Functoriality of naturality": the pseudonaturality axiom for composition 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">to_O_natural_compose</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ap</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>) (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (<span class="id" title="var">O_functor_compose</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>))^<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">to_O_natural</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor_compose</span>, <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_indpaths_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">inv_pp</span>, <span class="id" title="var">ap_V</span>, !<span class="id" title="var">inv_V</span>, !<span class="id" title="var">concat_pp_p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">concat_Vp</span>, <span class="id" title="var">concat_p1</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The pseudofunctoriality axiom 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_compose_compose</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">h</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> : <span class="id" title="var">O</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor_compose</span> <span class="id" title="var">f</span> (<span class="id" title="var">h</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span>) <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">O_functor_compose</span> <span class="id" title="var">g</span> <span class="id" title="var">h</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">O_functor_compose</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">h</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">ap</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">h</span>) (<span class="id" title="var">O_functor_compose</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_ind2paths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">composeD</span>, <span class="id" title="var">O_functor_compose</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">long_path_scope</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">O_indpaths_beta</span>, !<span class="id" title="var">ap_pp</span>, !<span class="id" title="var">ap_V</span>, !<span class="id" title="var">concat_p_pp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">whiskerL</span> <span class="id" title="var">_</span> (<span class="id" title="var">apD</span> <span class="id" title="var">_</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>)^)^ @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_indpaths_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_paths_FlFr</span>, !<span class="id" title="var">concat_p_pp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">ap_V</span>, <span class="id" title="var">inv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">concat_pV_p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">whiskerL</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">inverse2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ap_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">long_path_scope</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Preservation of equivalences 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_O_functor</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>^-1) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="var">O_functor_compose</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span>)^ @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">_</span> <span class="id" title="var">idmap</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">eisretr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor_idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="var">O_functor_compose</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span>)^ @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_functor_homotopy</span> <span class="id" title="var">_</span> <span class="id" title="var">idmap</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">eissect</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor_idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_functor</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
This is sometimes useful to have a separate name for, to facilitate rewriting along it. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">to_O_equiv_natural</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">equiv_O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) == (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">o</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span>.<br/>

<br/>
</div>

<div class="doc">
This corresponds to <span class="inlinecode"><span class="id" title="var">ap</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> on the universe. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ap_O_path_universe'</span> `{<span class="id" title="var">Univalence</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ap</span> <span class="id" title="var">O</span> (<span class="id" title="var">path_universe_uncurried</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">path_universe_uncurried</span> (<span class="id" title="var">equiv_O_functor</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">equiv_intro</span> (<span class="id" title="var">equiv_path</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>) <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">ap</span> <span class="id" title="var">O</span>) (<span class="id" title="var">eta_path_universe</span> <span class="id" title="var">p</span>) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveL_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_equiv</span>, <span class="id" title="var">path_arrow</span>, <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ap_O_path_universe</span> `{<span class="id" title="var">Univalence</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ap</span> <span class="id" title="var">O</span> (<span class="id" title="var">path_universe</span> <span class="id" title="var">f</span>) = <span class="id" title="var">path_universe</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">ap_O_path_universe'</span> (<span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span>).<br/>

<br/>
</div>

<div class="doc">
Postcomposition respects <span class="inlinecode"><span class="id" title="var">O_rec</span></span> 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec_postcompose</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} {<span class="id" title="var">C_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) <span class="id" title="var">f</span> == <span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
In particular, we have: 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec_postcompose_to_O</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">O_rec</span> <span class="id" title="var">f</span> == <span class="id" title="var">O_functor</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">O_rec_postcompose</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Functor</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Replete</span>.<br/>

<br/>
</div>

<div class="doc">
An equivalent formulation of repleteness is that a type lies in the subuniverse as soon as its unit map is an equivalence. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_isequiv_to_O</span> (<span class="id" title="var">T</span>:<span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) -&gt; <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">inO_equiv_inO</span> (<span class="id" title="var">O</span> <span class="id" title="var">T</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>)^-1.<br/>

<br/>
</div>

<div class="doc">
We don't make this an ordinary instance, but we allow it to solve <span class="inlinecode"><span class="id" title="var">In</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> constraints if we already have <span class="inlinecode"><span class="id" title="var">IsEquiv</span></span> as a hypothesis.  
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">inO_isequiv_to_O</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_iff_isequiv_to_O</span> (<span class="id" title="var">T</span>:<span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> &lt;-&gt; <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Thus, <span class="inlinecode"><span class="id" title="var">T</span></span> is in a subuniverse as soon as <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> admits a retraction. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_to_O_retract</span> (<span class="id" title="var">T</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">mu</span> : <span class="id" title="var">O</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">mu</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) == <span class="id" title="var">idmap</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_isequiv_to_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isequiv_adjointify</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">g</span>:=<span class="id" title="var">mu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span> <span class="id" title="var">o</span> <span class="id" title="var">mu</span>) <span class="id" title="var">idmap</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">exact</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">T</span>) (<span class="id" title="var">H</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It follows that reflective subuniverses are closed under retracts. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_retract_inO</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} (<span class="id" title="var">s</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">K</span> : <span class="id" title="var">r</span> <span class="id" title="var">o</span> <span class="id" title="var">s</span> == <span class="id" title="var">idmap</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nrapply</span> (<span class="id" title="var">inO_to_O_retract</span> <span class="id" title="var">A</span> (<span class="id" title="var">r</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)^-1 <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lhs</span> <span class="id" title="tactic">exact</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">r</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)^-1) (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lhs</span> <span class="id" title="var">nrefine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">r</span> (<span class="id" title="var">eissect</span> <span class="id" title="var">_</span> (<span class="id" title="var">s</span> <span class="id" title="var">a</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">K</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Replete</span>.<br/>

<br/>
</div>

<div class="doc">
The maps that are inverted by the reflector.  Note that this notation is not (yet) global (because notations in a section cannot be made global); it only exists in this section.  After the section is over, we will redefine it globally. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Local Notation</span> <span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span> := (<span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">OInverts</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">O_inverts_O_unit</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_homotopic</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>)) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor_wellpointed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A map between modal types that is inverted by <span class="inlinecode"><span class="id" title="var">O</span></span> is already an equivalence.  This can't be an <span class="inlinecode"><span class="id" title="keyword">Instance</span></span>, probably because it causes an infinite regress applying more and more <span class="inlinecode"><span class="id" title="var">O_functor</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_O_inverts</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_commsq'</span> <span class="id" title="var">f</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Strangely, even this seems to cause infinite loops  <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Immediate</span></span> <span class="inlinecode"><span class="id" title="var">isequiv_O_inverts</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">typeclass_instances</span>.</span> 
</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_inverts</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span> (<span class="id" title="var">isequiv_O_inverts</span> <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_O_rec_O_inverts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Not&nbsp;sure&nbsp;why&nbsp;we&nbsp;need&nbsp;<span class="inlinecode"><span class="id" title="var">C</span>:=<span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">B</span></span>&nbsp;on&nbsp;the&nbsp;next&nbsp;line&nbsp;to&nbsp;get&nbsp;Coq&nbsp;to&nbsp;use&nbsp;two&nbsp;typeclass&nbsp;instances.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">cancelL_isequiv</span> (<span class="id" title="var">C</span>:=<span class="id" title="var">O</span> <span class="id" title="var">B</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">isequiv_homotopic</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">O_rec_postcompose_to_O</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>)^)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_rec_O_inverts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">isequiv_O_rec_O_inverts</span> <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_to_O_O_inverts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">isequiv_homotopic</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_to_O_O_inverts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">isequiv_to_O_O_inverts</span> <span class="id" title="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">f</span></span> is inverted by <span class="inlinecode"><span class="id" title="var">O</span></span>, then mapping out of it into any modal type is an equivalence.  First we prove a version not requiring funext.  For use in <span class="inlinecode"><span class="id" title="var">O_inverts_O_leq</span></span> below, we allow the types <span class="inlinecode"><span class="id" title="var">A</span></span>, <span class="inlinecode"><span class="id" title="var">B</span></span>, and <span class="inlinecode"><span class="id" title="var">Z</span></span> to perhaps live in smaller universes than the one <span class="inlinecode"><span class="id" title="var">i</span></span> on which our subuniverse lives.  This the first half of Lemma 1.23 of RSS. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_O_inverts@</span>{<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">z</span> <span class="id" title="var">i</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">a</span>}} {<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">b</span>}} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Z</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">z</span>}) `{<span class="id" title="var">In@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">O</span> <span class="id" title="var">Z</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong@</span>{<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">z</span> <span class="id" title="var">i</span>} <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">cancelL_ooextendable@</span>{<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">i</span> <span class="id" title="var">z</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:<span class="id" title="tactic">exact</span> (<span class="id" title="var">extendable_to_O'@</span>{<span class="id" title="var">i</span> <span class="id" title="var">b</span> <span class="id" title="var">z</span>} <span class="id" title="var">O</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ooextendable_homotopic</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:<span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ooextendable_compose</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">srapply</span> <span class="id" title="var">ooextendable_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">extendable_to_O'@</span>{<span class="id" title="var">i</span> <span class="id" title="var">a</span> <span class="id" title="var">z</span>} <span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And now the funext version 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_precompose_O_inverts</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Z</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span>:<span class="id" title="var">B</span>-&gt;<span class="id" title="var">Z</span> =&gt; <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> (<span class="id" title="var">equiv_extendable_isequiv</span> 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">ooextendable_O_inverts</span> <span class="id" title="var">f</span> <span class="id" title="var">Z</span> 2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Conversely, if a map is inverted by the representable functor <span class="inlinecode">?</span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">Z</span></span> for all <span class="inlinecode"><span class="id" title="var">O</span></span>-modal types <span class="inlinecode"><span class="id" title="var">Z</span></span>, then it is inverted by <span class="inlinecode"><span class="id" title="var">O</span></span>.  As before, first we prove a version that doesn't require funext. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_from_extendable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} {<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Without the universe annotations, the result ends up insufficiently polymorphic. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">e</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">Z</span>:<span class="id" title="var">Type@</span>{<span class="id" title="var">k</span>}), <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span> -&gt; <span class="id" title="var">ExtendableAlong@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span>} 2 <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Z</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">isequiv_adjointify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">e</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">_</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">srapply</span> <span class="id" title="var">O_indpaths</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">e1</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> (<span class="id" title="var">e</span> (<span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span>) <span class="id" title="var">h</span> <span class="id" title="var">k</span>)). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> ((<span class="id" title="var">e1</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> ((<span class="id" title="var">fst</span> (<span class="id" title="var">e</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">_</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).1 <span class="id" title="var">y</span>)) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span>).1 <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> ((<span class="id" title="var">fst</span> (<span class="id" title="var">e</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">O_inO</span> <span class="id" title="var">A</span>)) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).2 <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">srapply</span> <span class="id" title="var">O_indpaths</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">to_O_natural</span>, <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> ((<span class="id" title="var">fst</span> (<span class="id" title="var">e</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">O_inO</span> <span class="id" title="var">A</span>)) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).2 <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 4 =&gt; <span class="id" title="tactic">progress</span> (<span class="id" title="tactic">cbv</span> <span class="id" title="keyword">beta</span> <span class="id" title="keyword">iota</span>) : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
And the version with funext.  Use it with universe parameters <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">lplus</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_from_isequiv_precompose</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">e</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">Z</span>:<span class="id" title="keyword">Type</span>), <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span> -&gt; <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span>:<span class="id" title="var">B</span>-&gt;<span class="id" title="var">Z</span> =&gt; <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Z</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> ((<span class="id" title="var">equiv_extendable_isequiv</span> 0 <span class="id" title="var">_</span> <span class="id" title="var">_</span>)^-1%<span class="id" title="var">equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
This property also characterizes the types in the subuniverse, which is the other half of Lemma 1.23. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_ooextendable_O_inverts</span> (<span class="id" title="var">Z</span>:<span class="id" title="var">Type@</span>{<span class="id" title="var">k</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">E</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Oif</span> : <span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ooExtendableAlong</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Z</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">EZ</span> := <span class="id" title="var">fst</span> (<span class="id" title="var">E</span> <span class="id" title="var">Z</span> (<span class="id" title="var">O</span> <span class="id" title="var">Z</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>) <span class="id" title="var">_</span> 1%<span class="id" title="var">nat</span>) <span class="id" title="var">idmap</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_to_O_retract</span> <span class="id" title="var">_</span> <span class="id" title="var">EZ</span>.1 <span class="id" title="var">EZ</span>.2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A version with the equivalence form of the extension condition. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_isequiv_precompose_O_inverts</span> (<span class="id" title="var">Z</span>:<span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Yo</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Oif</span> : <span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span>:<span class="id" title="var">B</span>-&gt;<span class="id" title="var">Z</span> =&gt; <span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">EZ</span> := <span class="id" title="var">extension_isequiv_precompose</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>) <span class="id" title="var">_</span> (<span class="id" title="var">Yo</span> <span class="id" title="var">Z</span> (<span class="id" title="var">O</span> <span class="id" title="var">Z</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">Z</span>) <span class="id" title="var">_</span>) <span class="id" title="var">idmap</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_to_O_retract</span> <span class="id" title="var">_</span> <span class="id" title="var">EZ</span>.1 <span class="id" title="var">EZ</span>.2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">to_O_inv_natural</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)^-1 <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) == <span class="id" title="var">f</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)^-1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">eissect</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Two maps between modal types that become equal after applying <span class="inlinecode"><span class="id" title="var">O_functor</span></span> are already equal. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_faithful_inO</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> == <span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">f</span> == <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">f</span> (<span class="id" title="var">eissect</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">x</span>)^ @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ <span class="id" title="var">ap</span> <span class="id" title="var">g</span> (<span class="id" title="var">eissect</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> ((<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)^-1 (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_inv_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">transitivity</span> ((<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>)^-1 (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_inv_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Any map to a type in the subuniverse that is inverted by <span class="inlinecode"><span class="id" title="var">O</span></span> must be equivalent to <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>.  More precisely, the type of such maps is contractible. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">typeof_to_O</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= { <span class="id" title="var">OA</span> : <span class="id" title="keyword">Type</span> &amp; { <span class="id" title="var">Ou</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">OA</span> &amp; ((<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">OA</span>) * (<span class="id" title="var">O_inverts</span> <span class="id" title="var">Ou</span>)) }}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">contr_typeof_O_unit</span> `{<span class="id" title="var">Univalence</span>} (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">Contr</span> (<span class="id" title="var">typeof_to_O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Build_Contr</span> <span class="id" title="var">_</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span> ; (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> ; (<span class="id" title="var">_</span> , <span class="id" title="var">_</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">OA</span> [<span class="id" title="var">Ou</span> [? ?]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">f</span> := <span class="id" title="var">O_rec</span> <span class="id" title="var">Ou</span> : <span class="id" title="var">O</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">OA</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">g</span> := (<span class="id" title="var">O_functor</span> <span class="id" title="var">Ou</span>)^-1 <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">OA</span> : (<span class="id" title="var">OA</span> -&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor_faithful_inO</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_functor_idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_functor_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">O_functor_compose</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">OA</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">Ou</span>)^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_functor_wellpointed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">to_O_natural</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">Ou</span>)^-1 <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">y</span> := (<span class="id" title="var">O_functor</span> <span class="id" title="var">Ou</span>)^-1 <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">Ou</span> <span class="id" title="var">y</span>); [ | <span class="id" title="tactic">apply</span> <span class="id" title="var">eisretr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">f</span>, <span class="id" title="var">O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_postcompose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">path_sigma</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">path_universe</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_sigma</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">path_sigma</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">cbn</span>; [ | <span class="id" title="tactic">apply</span> <span class="id" title="var">path_ishprop</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_arrow_fromconst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_path_universe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">f</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">OInverts</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="keyword">Types</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1256"></a><h2 class="section">The <span class="inlinecode"><span class="id" title="var">Unit</span></span> type</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_unit</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Unit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_to_O_retract@</span>{<span class="id" title="keyword">Set</span>} <span class="id" title="keyword">with</span> (<span class="id" title="var">mu</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">tt</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (@<span class="id" title="var">contr@</span>{<span class="id" title="keyword">Set</span>} <span class="id" title="var">Unit</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It follows that any contractible type is in <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_contr</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">Contr</span> <span class="id" title="var">A</span>} : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO@</span>{<span class="id" title="keyword">Set</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>} <span class="id" title="var">Unit</span> <span class="id" title="var">equiv_contr_unit</span>^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And that the reflection of a contractible type is still contractible. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">contr_O_contr</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">Contr</span> <span class="id" title="var">A</span>} : <span class="id" title="var">Contr</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">contr_equiv</span> <span class="id" title="var">A</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1257"></a><h2 class="section">Dependent product and arrows</h2>
 Theorem 7.7.2 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_forall</span> {<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">B</span>:<span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, (<span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">x</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; (<span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>:<span class="id" title="var">A</span>, (<span class="id" title="var">B</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">ev</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="keyword">fun</span> (<span class="id" title="var">f</span>:(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, (<span class="id" title="var">B</span> <span class="id" title="var">x</span>))) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">zz</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span>:<span class="id" title="var">A</span> =&gt; <span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) (<span class="id" title="var">ev</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_to_O_retract</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">mu</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">z</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">zz</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">phi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">zz</span>, <span class="id" title="var">ev</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">zz</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">ev</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_forall</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">x0</span>, (<span class="id" title="var">B</span> <span class="id" title="var">x0</span>) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">phi</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_arrow</span> {<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_forall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1258"></a><h2 class="section">Product</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_prod</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span>*<span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inO_to_O_retract</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">mu</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">X</span> =&gt; (@<span class="id" title="var">O_rec</span> <span class="id" title="var">_</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>) <span class="id" title="var">A</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fst</span> <span class="id" title="var">X</span> , <span class="id" title="var">O_rec</span> <span class="id" title="var">snd</span> <span class="id" title="var">X</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">path_prod</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">fst</span> (<span class="id" title="var">a</span>,<span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">snd</span> (<span class="id" title="var">a</span>,<span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Two ways to define a map <span class="inlinecode"><span class="id" title="var">O</span>(<span class="id" title="var">A</span></span> <span class="inlinecode">*</span> <span class="inlinecode"><span class="id" title="var">B</span>)</span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">*</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> agree. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_rec_functor_prod</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">X</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Y</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">X</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_rec</span> (<span class="id" title="var">functor_prod</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) == <span class="id" title="var">prod_coind</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">fst</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_rec</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">snd</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">Y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">ab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">functor_prod</span>, <span class="id" title="var">prod_coind</span>, <span class="id" title="var">prod_coind_uncurried</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lhs</span> (<span class="id" title="var">nrapply</span> <span class="id" title="var">O_rec_beta</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_prod</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="var">nrapply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We show that <span class="inlinecode"><span class="id" title="var">OA</span>*<span class="id" title="var">OB</span></span> has the same universal property as <span class="inlinecode"><span class="id" title="var">O</span>(<span class="id" title="var">A</span>*<span class="id" title="var">B</span>)</span> 
<div class="paragraph"> </div>

 Here is the map witnessing the universal property.  
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_prod_unit</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span> * <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">functor_prod</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>).<br/>

<br/>
</div>

<div class="doc">
We express the universal property without funext, using extensions. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_O_prod_unit</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">O_prod_unit</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ooextendable_functor_prod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">extendable_to_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Here's the version with funext. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_O_prod_unit_precompose</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">f</span> : (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) * (<span class="id" title="var">O</span> <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">C</span>) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">O_prod_unit</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">isequiv_ooextendable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_O_prod_unit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_prod_unit_precompose</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ((<span class="id" title="var">O</span> <span class="id" title="var">A</span>) * (<span class="id" title="var">O</span> <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">C</span>) &lt;~&gt; (<span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">isequiv_O_prod_unit_precompose</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>).<br/>

<br/>
</div>

<div class="doc">
The (funext-free) universal property implies that <span class="inlinecode"><span class="id" title="var">O_prod_unit</span></span> is an <span class="inlinecode"><span class="id" title="var">O</span></span>-equivalence, hence induces an equivalence between <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode">(<span class="id" title="var">A</span>*<span class="id" title="var">B</span>)</span> and <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode">*</span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">B</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">O_inverts_O_prod_unit</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">O_prod_unit</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_from_extendable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_O_prod_unit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_prod_cmp</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">O</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span> * <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">O_rec</span> (<span class="id" title="var">O_prod_unit</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_O_prod_cmp</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_prod_cmp</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">isequiv_O_rec_O_inverts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_prod_cmp</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>) &lt;~&gt; (<span class="id" title="var">O</span> <span class="id" title="var">A</span> * <span class="id" title="var">O</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_prod_cmp</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_path_O_prod</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">x0</span> <span class="id" title="var">x1</span> : <span class="id" title="var">X</span>} {<span class="id" title="var">y0</span> <span class="id" title="var">y1</span> : <span class="id" title="var">Y</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">x0</span>, <span class="id" title="var">y0</span>) = <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">x1</span>, <span class="id" title="var">y1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;~&gt; (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">x0</span> = <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">x1</span>) * (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">y0</span> = <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">y1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_ap'</span> (<span class="id" title="var">equiv_O_prod_cmp</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_concat_lr</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="var">only</span> 2: <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2,3: <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">equiv_path_prod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)^-1%<span class="id" title="var">equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_prod_cmp_coind</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_prod_cmp</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> == <span class="id" title="var">prod_coind</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">o</span> <span class="id" title="var">fst</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O_rec</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">o</span> <span class="id" title="var">snd</span> : <span class="id" title="var">A</span> * <span class="id" title="var">B</span> -&gt; <span class="id" title="var">O</span> <span class="id" title="var">B</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">O_rec_functor_prod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1259"></a><h2 class="section">Pullbacks</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_pullback</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pullback</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">inO_to_O_retract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">O_rec</span> <span class="id" title="var">pr1</span> <span class="id" title="var">op</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">p</span>.2.1) <span class="id" title="var">op</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">op</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> [<span class="id" title="var">b</span> [<span class="id" title="var">c</span> <span class="id" title="var">a</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">f</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) @ <span class="id" title="var">_</span>); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">a</span> @ <span class="id" title="var">ap</span> <span class="id" title="var">g</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)^).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">b</span> [<span class="id" title="var">c</span> <span class="id" title="var">a</span>]]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">path_sigma'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">transport_sigma'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> @ <span class="id" title="var">_</span>); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">path_sigma'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">abstract</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_paths_Fr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_paths_Fl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_indpaths_beta</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">concat_V_pp</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">ap_V</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concat_pV_p</span> ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1260"></a><h2 class="section">Fibers</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_hfiber</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_to_O_retract</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span>;<span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec</span> <span class="id" title="var">pr1</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">revert</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">f</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">pr1</span> <span class="id" title="var">x</span>) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">x</span>.2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>]; <span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">path_sigma'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">pr1</span> (<span class="id" title="var">a</span>;<span class="id" title="var">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">transport</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) (<span class="id" title="var">O_indpaths_beta</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) @ <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">transport_paths_Fl</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concat_V_pp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_unsigma</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} {<span class="id" title="var">B_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">x</span>}} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_fibration</span> <span class="id" title="var">x</span> <span class="id" title="var">B</span>)^-1.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">inO_unsigma</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
The reflector preserving hfibers is a characterization of lex modalities.  Here is the comparison map. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_hfiber</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>) -&gt; <span class="id" title="var">hfiber</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec</span>. <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ap</span>, <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_functor_hfiber_natural</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: (<span class="id" title="var">O_functor_hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>) <span class="id" title="var">o</span> <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>) == <span class="id" title="var">functor_hfiber</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">u</span> =&gt; (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">u</span>)^) <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>]; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor_hfiber</span>, <span class="id" title="var">functor_hfiber</span>, <span class="id" title="var">functor_sigma</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">ap</span> <span class="id" title="var">_</span> (<span class="id" title="var">inv_V</span> <span class="id" title="var">_</span> @@ 1))^.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">functor_sigma</span></span> over <span class="inlinecode"><span class="id" title="var">idmap</span></span> preserves <span class="inlinecode"><span class="id" title="var">O</span></span>-equivalences. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_functor_sigma_id</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">P</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">Q</span> <span class="id" title="var">a</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">O_inverts</span> (<span class="id" title="var">g</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">idmap</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Z</span> <span class="id" title="var">Z_inO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ooextendable_functor_sigma_id</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nrapply</span> <span class="id" title="var">ooextendable_O_inverts</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Theorem 7.3.9: The reflector <span class="inlinecode"><span class="id" title="var">O</span></span> can be discarded inside a reflected sum.  This can be obtained from <span class="inlinecode"><span class="id" title="var">O_inverts_functor_sigma_id</span></span> applied to the family of units <span class="inlinecode"><span class="id" title="var">to</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode">(<span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span>, but unfortunately the definitional behavior of the inverse obtained thereby (which here we take as the "forwards" direction) is poor.  So instead we give an explicit proof, but note that the "backwards" direction here is precisely <span class="inlinecode"><span class="id" title="var">functor_sigma</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_sigma_O</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>)} &lt;~&gt; <span class="id" title="var">O</span> {<span class="id" title="var">x</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span>}.<br/>
</div>

<div class="doc">
:= (Build_Equiv _   (O_inverts_functor_sigma_id (fun x =&gt; to O (P x))))^-1. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srapply</span> <span class="id" title="var">equiv_adjointify</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec</span>; <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">op</span>]; <span class="id" title="var">revert</span> <span class="id" title="var">op</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">a</span>;<span class="id" title="var">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">idmap</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">O_indpaths</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>]; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">abstract</span> (<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>); <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">O_indpaths</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">op</span>]; <span class="id" title="var">revert</span> <span class="id" title="var">op</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">abstract</span> (<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>); <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1261"></a><h2 class="section">Equivalences</h2>

<div class="paragraph"> </div>

 Naively it might seem that we need closure under Sigmas (hence a modality) to deduce closure under <span class="inlinecode"><span class="id" title="var">Equiv</span></span>, but in fact the above closure under fibers is sufficient.  This appears as part of the proof of Proposition 2.18 of CORS.  For later use, we try to reduce the number of universe parameters (but we don't completely control them all). 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_equiv</span> `{<span class="id" title="var">Funext</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">issig_equiv@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span>} <span class="id" title="var">A</span> <span class="id" title="var">B</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_functor_sigma</span> <span class="id" title="var">equiv_idmap@</span>{<span class="id" title="var">k</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">equiv_biinv_isequiv@</span>{<span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">k</span>} <span class="id" title="var">f</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transparent</span> <span class="id" title="tactic">assert</span> (<span class="id" title="var">c</span> : (<span class="id" title="var">prod@</span>{<span class="id" title="var">k</span> <span class="id" title="var">k</span>} (<span class="id" title="var">A</span>-&gt;<span class="id" title="var">B</span>) (<span class="id" title="var">prod@</span>{<span class="id" title="var">k</span> <span class="id" title="var">k</span>} (<span class="id" title="var">B</span>-&gt;<span class="id" title="var">A</span>) (<span class="id" title="var">B</span>-&gt;<span class="id" title="var">A</span>)) -&gt; <span class="id" title="var">prod@</span>{<span class="id" title="var">k</span> <span class="id" title="var">k</span>} (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">B</span> -&gt; <span class="id" title="var">B</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> [<span class="id" title="var">f</span> [<span class="id" title="var">g</span> <span class="id" title="var">h</span>]]; <span class="id" title="tactic">exact</span> (<span class="id" title="var">h</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>, <span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">U</span> := <span class="id" title="var">hfiber@</span>{<span class="id" title="var">k</span> <span class="id" title="var">k</span>} <span class="id" title="var">c</span> (<span class="id" title="var">idmap</span>, <span class="id" title="var">idmap</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO'@</span>{<span class="id" title="var">k</span> <span class="id" title="var">k</span> <span class="id" title="var">k</span>} <span class="id" title="var">U</span> <span class="id" title="var">_</span>). </div>

<div class="doc">
Introduces some extra copies of <span class="inlinecode"><span class="id" title="var">k</span></span> by typeclass inference. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">hfiber</span>, <span class="id" title="var">BiInv</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srefine</span> (<span class="id" title="var">equiv_adjointify</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [[<span class="id" title="var">f</span> [<span class="id" title="var">g</span> <span class="id" title="var">h</span>]] <span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">equiv_path_prod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">q</span>]; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f</span>; <span class="id" title="tactic">split</span>; [ <span class="id" title="tactic">exists</span> <span class="id" title="var">h</span> | <span class="id" title="tactic">exists</span> <span class="id" title="var">g</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">f</span> [[<span class="id" title="var">g</span> <span class="id" title="var">p</span>] [<span class="id" title="var">h</span> <span class="id" title="var">q</span>]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">f</span>,(<span class="id" title="var">h</span>,<span class="id" title="var">g</span>)); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_prod</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">f</span> [[<span class="id" title="var">g</span> <span class="id" title="var">p</span>] [<span class="id" title="var">h</span> <span class="id" title="var">q</span>]]]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">path_sigma'</span> <span class="id" title="var">_</span> 1); <span class="id" title="tactic">apply</span> <span class="id" title="var">path_prod</span>; <span class="id" title="tactic">apply</span> (<span class="id" title="var">path_sigma'</span> <span class="id" title="var">_</span> 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">transport_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:<span class="id" title="tactic">rewrite</span> <span class="id" title="var">ap_fst_path_prod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">rewrite</span> <span class="id" title="var">ap_snd_path_prod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">apply</span> <span class="id" title="var">path_forall</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">ap10_path_arrow</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">fghp</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">path_sigma'</span> <span class="id" title="var">_</span> 1); <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> @ <span class="id" title="var">eta_path_prod</span> (<span class="id" title="var">pr2</span> <span class="id" title="var">fghp</span>)); <span class="id" title="tactic">apply</span> <span class="id" title="var">ap011</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">eta_path_arrow</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1262"></a><h2 class="section">Paths</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inO_paths@</span>{<span class="id" title="var">i</span>} (<span class="id" title="var">S</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) {<span class="id" title="var">S_inO</span> : <span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">S</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">x</span>=<span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simple</span> <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_to_O_retract@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intro</span> <span class="id" title="var">u</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">p</span> : (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <span class="id" title="var">O</span> (<span class="id" title="var">x</span>=<span class="id" title="var">y</span>) =&gt; <span class="id" title="var">x</span>) == (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span>=&gt; <span class="id" title="var">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_indpaths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">v</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">v</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">p</span> <span class="id" title="var">u</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_indpaths_beta</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">inO_paths</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">O_concat</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">a0</span> <span class="id" title="var">a1</span> <span class="id" title="var">a2</span> : <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">a0</span> = <span class="id" title="var">a1</span>) -&gt; <span class="id" title="var">O</span> (<span class="id" title="var">a1</span> = <span class="id" title="var">a2</span>) -&gt; <span class="id" title="var">O</span> (<span class="id" title="var">a0</span> = <span class="id" title="var">a2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">strip_reflections</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">p</span> @ <span class="id" title="var">q</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1263"></a><h2 class="section">Truncations</h2>

<div class="paragraph"> </div>

 The reflector preserves hprops (and, as we have already seen, contractible types), although it doesn't generally preserve <span class="inlinecode"><span class="id" title="var">n</span></span>-types for other <span class="inlinecode"><span class="id" title="var">n</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ishprop_O_ishprop</span> {<span class="id" title="var">A</span>} `{<span class="id" title="var">IsHProp</span> <span class="id" title="var">A</span>} : <span class="id" title="var">IsHProp</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> <span class="id" title="var">ishprop_isequiv_diag</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_homotopic</span> (<span class="id" title="var">O_prod_cmp</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">o</span> <span class="id" title="var">O_functor</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">a</span>:<span class="id" title="var">A</span>) =&gt; (<span class="id" title="var">a</span>,<span class="id" title="var">a</span>))) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">O_prod_cmp</span> <span class="id" title="var">A</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to_O_natural</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">a</span>:<span class="id" title="var">A</span>) =&gt; (<span class="id" title="var">a</span>,<span class="id" title="var">a</span>)) <span class="id" title="var">x</span>) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_prod_cmp</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">A</span></span> is <span class="inlinecode"><span class="id" title="var">In</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>, then so is <span class="inlinecode"><span class="id" title="var">IsTrunc</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_istrunc</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">n</span>} {<span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">IsTrunc</span> <span class="id" title="var">n</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">A</span>; <span class="id" title="var">simple_induction</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">IH</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </div>

<div class="doc">
We have to be slightly clever here: the actual definition of <span class="inlinecode"><span class="id" title="var">Contr</span></span> involves a sigma, which <span class="inlinecode"><span class="id" title="var">O</span></span> is not generally closed under, but fortunately we have <span class="inlinecode"><span class="id" title="var">equiv_contr_inhabited_allpath</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> <span class="id" title="var">equiv_contr_inhabited_allpath</span>^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_istrunc_unfold</span> <span class="id" title="var">n</span>.+1 <span class="id" title="var">A</span>)^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1264"></a><h2 class="section">Coproducts</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_functor_sum</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">functor_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extendable_functor_sum</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ooextendable_O_inverts</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_functor_sum</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">A</span> + <span class="id" title="var">B</span>) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">A'</span> + <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_inverts_functor_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_sum</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O</span> (<span class="id" title="var">A</span> + <span class="id" title="var">B</span>) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span> + <span class="id" title="var">O</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">equiv_O_functor_sum</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>).<br/>

<br/>
</div>

<div class="doc">
<a id="lab1265"></a><h2 class="section">Coequalizers</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">OCoeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">B</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_functor_coeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B'</span> <span class="id" title="var">A'</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">f'</span> <span class="id" title="var">g'</span> : <span class="id" title="var">B'</span> -&gt; <span class="id" title="var">A'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">functor_coeq</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Z</span> <span class="id" title="var">Z_inO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extendable_functor_coeq'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="var">nrapply</span> <span class="id" title="var">ooextendable_O_inverts</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_functor_coeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B'</span> <span class="id" title="var">A'</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f'</span> <span class="id" title="var">g'</span> : <span class="id" title="var">B'</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> <span class="id" title="var">f'</span> <span class="id" title="var">g'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_inverts_functor_coeq</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">coeq_cmp</span> : <span class="id" title="var">Coeq</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> -&gt; <span class="id" title="var">Coeq</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">functor_coeq</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> =&gt; (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">y</span>)^)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> =&gt; (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> <span class="id" title="var">y</span>)^).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isequiv_O_coeq_cmp</span> : <span class="id" title="var">O_inverts</span> <span class="id" title="var">coeq_cmp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_functor_coeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_coeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">coeq_cmp</span>) <span class="id" title="var">_</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_coeq_to_O</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_coeq</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">coeq</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">coeq</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inverse_equiv_O_coeq_to_O</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_coeq</span>^-1 (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">coeq</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Coeq</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">coeq</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_coeq_to_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">OCoeq</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1266"></a><h2 class="section">Pushouts</h2>

</div>
<div class="code">

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">OPushout</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_functor_pushout</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">C'</span>} {<span class="id" title="var">f'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">B'</span>} {<span class="id" title="var">g'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">l</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">h</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">l</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> (<span class="id" title="var">functor_pushout</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_functor_coeq</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_functor_sum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_pushout</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_inverts_functor_pushout</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>)^)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span>)^)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_pushout_to_O_pushl</span> (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_pushout</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">pushl</span> <span class="id" title="var">b</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">pushl</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_pushout_to_O_pushr</span> (<span class="id" title="var">c</span> : <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_pushout</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">pushr</span> <span class="id" title="var">c</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">pushr</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span> <span class="id" title="var">c</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">to_O_natural</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inverse_equiv_O_pushout_to_O_pushl</span> (<span class="id" title="var">b</span> : <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_pushout</span>^-1 (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">pushl</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span> <span class="id" title="var">b</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">pushl</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_pushout_to_O_pushl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">inverse_equiv_O_pushout_to_O_pushr</span> (<span class="id" title="var">c</span> : <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">equiv_O_pushout</span>^-1 (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>)) (<span class="id" title="var">pushr</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span> <span class="id" title="var">c</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">Pushout</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">pushr</span> <span class="id" title="var">c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">moveR_equiv_V</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_pushout_to_O_pushr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">OPushout</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="keyword">Types</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Decidable</span>.<br/>

<br/>
</div>

<div class="doc">
If <span class="inlinecode"><span class="id" title="var">Empty</span></span> belongs to <span class="inlinecode"><span class="id" title="var">O</span></span>, then <span class="inlinecode"><span class="id" title="var">O</span></span> preserves decidability. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">decidable_O</span> `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Empty</span>} (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">Decidable</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> <span class="id" title="var">A</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">y</span>|<span class="id" title="var">n</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inl</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">y</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inr</span> (<span class="id" title="var">O_rec</span> <span class="id" title="var">n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Dually, if <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span> is decidable, then <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode">(<span class="id" title="var">Decidable</span></span> <span class="inlinecode"><span class="id" title="var">A</span>)</span>. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_decidable</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Decidable</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">Decidable</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">dec</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">y</span>|<span class="id" title="var">n</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">inl</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">inr</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">to</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">n</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Decidable</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">Monad</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_mult</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">O</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">O_rec</span> <span class="id" title="var">idmap</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_mult_natural</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> <span class="id" title="var">o</span> <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span> == <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">O_functor</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">to_O_natural</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span>) <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">idmap</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">idmap</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_unitlaw1</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span> <span class="id" title="var">o</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>)) == <span class="id" title="var">idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_mult</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">idmap</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_unitlaw2</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span> <span class="id" title="var">o</span> (<span class="id" title="var">O_functor</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)) == <span class="id" title="var">idmap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_mult</span>, <span class="id" title="var">O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_mult_assoc</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span> <span class="id" title="var">o</span> <span class="id" title="var">O_monad_mult</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) == <span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span> <span class="id" title="var">o</span> <span class="id" title="var">O_functor</span> (<span class="id" title="var">O_monad_mult</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_mult</span>, <span class="id" title="var">O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">Monad</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">StrongMonad</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">fs</span> : <span class="id" title="var">Funext</span>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>) : <span class="id" title="var">A</span> * <span class="id" title="var">O</span> <span class="id" title="var">B</span> -&gt; <span class="id" title="var">O</span> (<span class="id" title="var">A</span> * <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">aob</span> =&gt; <span class="id" title="var">O_rec</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span>*<span class="id" title="var">B</span>) (<span class="id" title="var">a</span>,<span class="id" title="var">b</span>)) (<span class="id" title="var">snd</span> <span class="id" title="var">aob</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">aob</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength_natural</span> (<span class="id" title="var">A</span> <span class="id" title="var">A'</span> <span class="id" title="var">B</span> <span class="id" title="var">B'</span> : <span class="id" title="keyword">Type</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> (<span class="id" title="var">functor_prod</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) <span class="id" title="var">o</span> <span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> ==<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">o</span> <span class="id" title="var">functor_prod</span> <span class="id" title="var">f</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b</span>]. <span class="id" title="var">revert</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">strip_reflections</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_strength</span>, <span class="id" title="var">O_functor</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The diagrams for strength, see http://en.wikipedia.org/wiki/Strong_monad 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength_unitlaw1</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> (@<span class="id" title="var">snd</span> <span class="id" title="var">Unit</span> <span class="id" title="var">A</span>) <span class="id" title="var">o</span> <span class="id" title="var">O_monad_strength</span> <span class="id" title="var">Unit</span> <span class="id" title="var">A</span> == @<span class="id" title="var">snd</span> <span class="id" title="var">Unit</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [[] <span class="id" title="var">a</span>]. <span class="id" title="var">strip_reflections</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_strength</span>, <span class="id" title="var">O_functor</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nrapply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength_unitlaw2</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">functor_prod</span> <span class="id" title="var">idmap</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) == <span class="id" title="var">to</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span>*<span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_strength</span>, <span class="id" title="var">functor_prod</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nrapply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength_assoc1</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_functor</span> (<span class="id" title="var">equiv_prod_assoc</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>)^-1 <span class="id" title="var">o</span> <span class="id" title="var">O_monad_strength</span> (<span class="id" title="var">A</span>*<span class="id" title="var">B</span>) <span class="id" title="var">C</span> ==<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> (<span class="id" title="var">B</span>*<span class="id" title="var">C</span>) <span class="id" title="var">o</span> <span class="id" title="var">functor_prod</span> <span class="id" title="var">idmap</span> (<span class="id" title="var">O_monad_strength</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>) <span class="id" title="var">o</span> (<span class="id" title="var">equiv_prod_assoc</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> (<span class="id" title="var">O</span> <span class="id" title="var">C</span>))^-1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [[<span class="id" title="var">a</span> <span class="id" title="var">b</span>] <span class="id" title="var">c</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>. <span class="id" title="var">revert</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">strip_reflections</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_strength</span>, <span class="id" title="var">O_functor</span>, <span class="id" title="var">functor_prod</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_monad_strength_assoc2</span> (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_monad_mult</span> (<span class="id" title="var">A</span>*<span class="id" title="var">B</span>) <span class="id" title="var">o</span> <span class="id" title="var">O_functor</span> (<span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>) <span class="id" title="var">o</span> <span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> (<span class="id" title="var">O</span> <span class="id" title="var">B</span>) ==<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">O_monad_strength</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">o</span> <span class="id" title="var">functor_prod</span> <span class="id" title="var">idmap</span> (<span class="id" title="var">O_monad_mult</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b</span>]. <span class="id" title="var">revert</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">ap10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">strip_reflections</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_arrow</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_monad_strength</span>, <span class="id" title="var">O_functor</span>, <span class="id" title="var">O_monad_mult</span>, <span class="id" title="var">functor_prod</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">O_rec_beta</span>; <span class="id" title="tactic">simpl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">StrongMonad</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Reflective_Subuniverse</span>.<br/>

<br/>
</div>

<div class="doc">
Now we make the <span class="inlinecode"><span class="id" title="var">O_inverts</span></span> notation global. 
</div>
<div class="code">
<span class="id" title="keyword">Notation</span> <span class="id" title="var">O_inverts</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span> := (<span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>)).<br/>

<br/>
</div>

<div class="doc">
<a id="lab1267"></a><h2 class="section">Modally connected types</h2>

<div class="paragraph"> </div>

 Connectedness of a type, relative to a modality or reflective subuniverse, can be defined in two equivalent ways: quantifying over all maps into modal types, or by considering just the universal case, the modal reflection of the type itself.  The former requires only core Coq, but blows up the size (universe level) of <span class="inlinecode"><span class="id" title="var">IsConnected</span></span>, since it quantifies over types; moreover, it is not even quite correct since (at least with a polymorphic modality) it should really be quantified over all universes.  Thus, we use the latter, although in most examples it requires HITs to define the modal reflection.

<div class="paragraph"> </div>

Question: is there a definition of connectedness (say, for n-types) that neither blows up the universe level, nor requires HIT's? 
<div class="paragraph"> </div>

 We give annotations to reduce the number of universe parameters. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">IsConnected</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i</span>}) (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;:= <span class="id" title="var">isconnected_contr_O</span> : <span class="id" title="var">Contr@</span>{<span class="id" title="var">i</span>} (<span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>

<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">isconnected_contr_O</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ConnectedTypes</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>).<br/>

<br/>
</div>

<div class="doc">
Being connected is an hprop 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ishprop_isconnected</span> `{<span class="id" title="var">Funext</span>} <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;: <span class="id" title="var">IsHProp</span> (<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">IsConnected</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Anything equivalent to a connected type is connected. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_equiv</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ?; <span class="id" title="tactic">refine</span> (<span class="id" title="var">contr_equiv</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">O_functor</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_equiv'</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">A</span> <span class="id" title="var">f</span>.<br/>

<br/>
</div>

<div class="doc">
The O-connected types form a subuniverse. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Conn</span> : <span class="id" title="var">Subuniverse</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">Build_Subuniverse</span> (<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> <span class="id" title="var">isconnT</span> <span class="id" title="var">f</span> <span class="id" title="var">isequivf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">T</span> <span class="id" title="var">f</span> <span class="id" title="var">isconnT</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connectedness of a type <span class="inlinecode"><span class="id" title="var">A</span></span> can equivalently be characterized by the fact that any map to an <span class="inlinecode"><span class="id" title="var">O</span></span>-type <span class="inlinecode"><span class="id" title="var">C</span></span> is nullhomotopic.  Here is one direction of that equivalence. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_elim</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">NullHomotopy</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">ff</span> := @<span class="id" title="var">O_rec</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">ff</span> (<span class="id" title="var">center</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">ff</span> (<span class="id" title="var">contr</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">a</span>)) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_rec_beta</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
For the other direction of the equivalence, it's sufficient to consider the case when <span class="inlinecode"><span class="id" title="var">C</span></span> is <span class="inlinecode"><span class="id" title="var">O</span></span> <span class="inlinecode"><span class="id" title="var">A</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_from_elim_to_O</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">NullHomotopy</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) -&gt; <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">nh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Build_Contr</span> <span class="id" title="var">_</span> (<span class="id" title="var">nh</span> .1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_indpaths</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> (<span class="id" title="var">nh</span> .2).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Now the general case follows. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_from_elim</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>), <span class="id" title="var">NullHomotopy</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">isconnected_from_elim_to_O</span> (<span class="id" title="var">H</span> (<span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">O_inO</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connected types are closed under sigmas. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isconnected_sigma</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> {<span class="id" title="var">a</span>:<span class="id" title="var">A</span> &amp; <span class="id" title="var">B</span> <span class="id" title="var">a</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isconnected_from_elim</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> ? <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">nB</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; @<span class="id" title="var">isconnected_elim</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> <span class="id" title="var">C</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">f</span> (<span class="id" title="var">a</span>;<span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">nA</span> := <span class="id" title="var">isconnected_elim</span> <span class="id" title="var">C</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; (<span class="id" title="var">nB</span> <span class="id" title="var">a</span>).1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">nA</span>.1); <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">b</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> ((<span class="id" title="var">nB</span> <span class="id" title="var">a</span>).2 <span class="id" title="var">b</span> @ <span class="id" title="var">nA</span>.2 <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Contractible types are connected. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">isconnected_contr</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">Contr</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">contr_O_contr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A type which is both connected and modal is contractible. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">contr_trunc_conn</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">Contr</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">contr_equiv</span> <span class="id" title="var">_</span> (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Any map between connected types is inverted by O. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">O_inverts_isconnected</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Here's another way of stating the universal property for mapping out of connected types into modal ones. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">extendable_const_isconnected_inO</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ExtendableAlong</span> <span class="id" title="var">n</span> (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">C</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">simple_induction</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">IHn</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> ?;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span> | <span class="id" title="tactic">split</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <span class="id" title="var">Unit</span> =&gt; (<span class="id" title="var">isconnected_elim</span> <span class="id" title="var">C</span> <span class="id" title="var">f</span>).1); <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> ((<span class="id" title="var">isconnected_elim</span> <span class="id" title="var">C</span> <span class="id" title="var">f</span>).2).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">extendable_postcompose'</span> <span class="id" title="var">n</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">IHn</span> (<span class="id" title="var">h</span> <span class="id" title="var">tt</span> = <span class="id" title="var">k</span> <span class="id" title="var">tt</span>) (<span class="id" title="var">inO_paths</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> []; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_idmap</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_const_isconnected_inO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}) `{<span class="id" title="var">IsConnected@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">extendable_const_isconnected_inO</span> <span class="id" title="var">n</span> <span class="id" title="var">A</span> <span class="id" title="var">C</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_const_isconnected_inO</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (@<span class="id" title="var">const</span> <span class="id" title="var">A</span> <span class="id" title="var">C</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (@<span class="id" title="var">isequiv_compose</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> <span class="id" title="var">u</span> =&gt; <span class="id" title="var">c</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">isequiv_ooextendable</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">C</span>) (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ooextendable_const_isconnected_inO</span> <span class="id" title="var">A</span> <span class="id" title="var">C</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_const_isconnected_inO</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} (<span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">C</span> &lt;~&gt; (<span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>) := <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">const</span> (<span class="id" title="var">isequiv_const_isconnected_inO</span> <span class="id" title="var">C</span>).<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ConnectedTypes</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1268"></a><h2 class="section">Modally truncated maps</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ModalMaps</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse</span>).<br/>

<br/>
</div>

<div class="doc">
Any equivalence is modal 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_isequiv</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A slightly specialized result: if <span class="inlinecode"><span class="id" title="var">Empty</span></span> is modal, then a map with decidable hprop fibers (such as <span class="inlinecode"><span class="id" title="var">inl</span></span> or <span class="inlinecode"><span class="id" title="var">inr</span></span>) is modal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_hfiber_decidable_hprop</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">Empty</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">IsHProp</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">Decidable</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">equiv_decidable_hprop</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">e</span>|<span class="id" title="var">e</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">Unit</span> <span class="id" title="var">e</span>^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">Empty</span> <span class="id" title="var">e</span>^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Any map between modal types is modal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_between_inO</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Modal maps cancel on the left. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelL_mapinO</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span> -&gt; <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) -&gt; <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? ? <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_hfiber_compose_map</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Modal maps also cancel with equivalences on the other side. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelR_isequiv_mapinO</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srefine</span> (<span class="id" title="var">inO_equiv_inO'</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">b</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">equiv_functor_sigma</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; 1%<span class="id" title="var">equiv</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelR_equiv_mapinO</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> &lt;~&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">cancelR_isequiv_mapinO</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>.<br/>

<br/>
</div>

<div class="doc">
The pullback of a modal map is modal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_pullback</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span>) `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">f</span>^* <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_pullback_along</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_pullback'</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span>^*' <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_pullback_along'</span> <span class="id" title="var">g</span> <span class="id" title="var">f</span> <span class="id" title="var">c</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">functor_sum</span></span> preserves modal maps. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">mapinO_functor_sum</span> {<span class="id" title="var">A</span> <span class="id" title="var">A'</span> <span class="id" title="var">B</span> <span class="id" title="var">B'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span>|<span class="id" title="var">b</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_functor_sum_l</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">a</span>)^-1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_functor_sum_r</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
So does <span class="inlinecode"><span class="id" title="var">unfunctor_sum</span></span>, if both summands are preserved.  These can't be <span class="inlinecode"><span class="id" title="keyword">Instance</span></span>s since they require <span class="inlinecode"><span class="id" title="var">Ha</span></span> and <span class="inlinecode"><span class="id" title="var">Hb</span></span> to be supplied. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapinO_unfunctor_sum_l</span> {<span class="id" title="var">A</span> <span class="id" title="var">A'</span> <span class="id" title="var">B</span> <span class="id" title="var">B'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> + <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A'</span> + <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Ha</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">is_inl</span> (<span class="id" title="var">h</span> (<span class="id" title="var">inl</span> <span class="id" title="var">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Hb</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">is_inr</span> (<span class="id" title="var">h</span> (<span class="id" title="var">inr</span> <span class="id" title="var">b</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">unfunctor_sum_l</span> <span class="id" title="var">h</span> <span class="id" title="var">Ha</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_unfunctor_sum_l</span> <span class="id" title="var">h</span> <span class="id" title="var">Ha</span> <span class="id" title="var">Hb</span> <span class="id" title="var">a</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapinO_unfunctor_sum_r</span> {<span class="id" title="var">A</span> <span class="id" title="var">A'</span> <span class="id" title="var">B</span> <span class="id" title="var">B'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> + <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A'</span> + <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Ha</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">is_inl</span> (<span class="id" title="var">h</span> (<span class="id" title="var">inl</span> <span class="id" title="var">a</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Hb</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">is_inr</span> (<span class="id" title="var">h</span> (<span class="id" title="var">inr</span> <span class="id" title="var">b</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">unfunctor_sum_r</span> <span class="id" title="var">h</span> <span class="id" title="var">Hb</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_unfunctor_sum_r</span> <span class="id" title="var">h</span> <span class="id" title="var">Ha</span> <span class="id" title="var">Hb</span> <span class="id" title="var">b</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Given a family of maps <span class="inlinecode"><span class="id" title="var">f</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">forall</span></span> <span class="inlinecode"><span class="id" title="var">a</span>,</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">-&gt;</span> <span class="inlinecode"><span class="id" title="var">Q</span></span> <span class="inlinecode"><span class="id" title="var">a</span></span> which are in <span class="inlinecode"><span class="id" title="var">O</span></span>, the induced map on Pi types is also in <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapinO_functor_forall_id</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">P</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">Q</span> <span class="id" title="var">a</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_forall_id</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">inO_equiv_inO</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_functor_forall_id</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>)^-1%<span class="id" title="var">equiv</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ModalMaps</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1269"></a><h2 class="section">Modally connected maps</h2>

<div class="paragraph"> </div>

 Connectedness of a map can again be defined in two equivalent ways: by connectedness of its fibers (as types), or by the lifting property/elimination principle against modal types.  We use the former; the equivalence with the latter is given below in <span class="inlinecode"><span class="id" title="var">conn_map_elim</span></span>, <span class="inlinecode"><span class="id" title="var">conn_map_comp</span></span>, and <span class="inlinecode"><span class="id" title="var">conn_map_from_extension_elim</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">IsConnMap</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} {<span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i</span>}} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">isconnected_hfiber_conn_map</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
The extra universe <span class="inlinecode"><span class="id" title="var">k</span></span> is &gt;= max(i,j). 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">IsConnected@</span>{<span class="id" title="var">i</span>} <span class="id" title="var">O</span> (<span class="id" title="var">hfiber@</span>{<span class="id" title="var">i</span> <span class="id" title="var">i</span>} <span class="id" title="var">f</span> <span class="id" title="var">b</span>).<br/>

<br/>
<span class="id" title="keyword">Global Existing Instance</span> <span class="id" title="var">isconnected_hfiber_conn_map</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ConnectedMaps</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Universe</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">O</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i</span>}).<br/>

<br/>
</div>

<div class="doc">
Any equivalence is connected 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_isequiv</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Anything homotopic to a connected map is connected. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_homotopic</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">h</span> : <span class="id" title="var">f</span> == <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span> -&gt; <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ? <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber@</span>{<span class="id" title="var">i</span> <span class="id" title="var">i</span>} <span class="id" title="var">f</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_hfiber_homotopic@</span>{<span class="id" title="var">i</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span>} <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">h</span> <span class="id" title="var">b</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The pullback of a connected map is connected 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_pullback</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">f</span>^* <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_pullback_along</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span>)^-1 <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_pullback'</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span>^*' <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">hfiber_pullback_along'</span> <span class="id" title="var">g</span> <span class="id" title="var">f</span> <span class="id" title="var">c</span>)^-1 <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
The projection from a family of connected types is connected. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_pr1</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (@<span class="id" title="var">pr1</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">O</span> (<span class="id" title="var">B</span> <span class="id" title="var">a</span>) (<span class="id" title="var">hfiber_fibration</span> <span class="id" title="var">a</span> <span class="id" title="var">B</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Being connected is an hprop 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">ishprop_isconnmap</span> `{<span class="id" title="var">Funext</span>} {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsHProp</span> (<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">istrunc_forall</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connected maps are orthogonal to modal maps (i.e. familes of modal types). 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_elim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">P</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">pr1</span> (<span class="id" title="var">isconnected_elim</span> <span class="id" title="var">O</span> (<span class="id" title="var">A</span>:=<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">transport</span> <span class="id" title="var">P</span> <span class="id" title="var">p</span> (<span class="id" title="var">d</span> <span class="id" title="var">a</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_comp</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>) = <span class="id" title="var">d</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">conn_map_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">fibermap</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">a0p</span> : <span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; <span class="id" title="keyword">let</span> (<span class="id" title="var">a0</span>, <span class="id" title="var">p</span>) := <span class="id" title="var">a0p</span> <span class="id" title="tactic">in</span> <span class="id" title="var">transport</span> <span class="id" title="var">P</span> <span class="id" title="var">p</span> (<span class="id" title="var">d</span> <span class="id" title="var">a0</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">isconnected_elim</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)) <span class="id" title="var">fibermap</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">x</span> <span class="id" title="var">e</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="var">d</span> <span class="id" title="var">a</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">fibermap</span> (<span class="id" title="var">a</span>;1)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">inverse</span>, <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
A map which is both connected and modal is an equivalence. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_conn_ino_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isequiv_contr_map</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">contr_trunc_conn</span> <span class="id" title="var">O</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We can re-express this in terms of extensions. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">extension_conn_map_elim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;: <span class="id" title="var">ExtensionAlong</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_comp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">extendable_conn_map_inO</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ExtendableAlong</span> <span class="id" title="var">n</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">simple_induction</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">IHn</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> ?; [ <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span> | <span class="id" title="tactic">split</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">extension_conn_map_elim</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHn</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_conn_map_inO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">extendable_conn_map_inO</span> <span class="id" title="var">n</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">allpath_extension_conn_map</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">e</span> <span class="id" title="var">e'</span> : <span class="id" title="var">ExtensionAlong</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">e</span> = <span class="id" title="var">e'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_extension</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">extension_conn_map_elim</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It follows that <span class="inlinecode"><span class="id" title="var">conn_map_elim</span></span> is actually an equivalence. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">isequiv_o_conn_map</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">g</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">P</span> <span class="id" title="var">b</span>) =&gt; <span class="id" title="var">g</span> <span class="id" title="var">oD</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isequiv_contr_map</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">contr_inhabited_hprop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">nrefine</span> (@<span class="id" title="var">istrunc_equiv_istrunc</span> {<span class="id" title="var">g</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">P</span> <span class="id" title="var">b</span> &amp; <span class="id" title="var">g</span> <span class="id" title="var">oD</span> <span class="id" title="var">f</span> == <span class="id" title="var">d</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_functor_sigma_id</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_path_forall</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hprop_allpath</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">g</span> <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">allpath_extension_conn_map</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span> <span class="id" title="var">g</span> <span class="id" title="var">h</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_forall</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_comp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_o_conn_map</span> `{<span class="id" title="var">Funext</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) `{<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">P</span> <span class="id" title="var">b</span>) &lt;~&gt; (<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;:= <span class="id" title="var">Build_Equiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">isequiv_o_conn_map</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span>).<br/>

<br/>
</div>

<div class="doc">
When considering lexness properties, we often want to consider the property of the universe of modal types being modal.  We can't say this directly (except in the accessible, hence liftable, case) because it lives in a higher universe, but we can make a direct extendability statement.  Here we prove a lemma that oo-extendability into the universe follows from plain extendability, essentially because the type of equivalences between two <span class="inlinecode"><span class="id" title="var">O</span></span>-modal types is <span class="inlinecode"><span class="id" title="var">O</span></span>-modal. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">ooextendable_TypeO_from_extension</span> `{<span class="id" title="var">Univalence</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">extP</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">Type_</span> <span class="id" title="var">O</span>, <span class="id" title="var">ExtensionAlong</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <span class="id" title="var">B</span> =&gt; <span class="id" title="var">Type_</span> <span class="id" title="var">O</span>) <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">ooExtendableAlong</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">Type_</span> <span class="id" title="var">O</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
</div>

<div class="doc">
By definition, in addition to our assumption <span class="inlinecode"><span class="id" title="var">extP</span></span> that maps into <span class="inlinecode"><span class="id" title="var">Type_</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span> extend along <span class="inlinecode"><span class="id" title="var">f</span></span>, we must show that sections of families of equivalences are <span class="inlinecode"><span class="id" title="var">ooExtendableAlong</span></span> it.  
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [|[|<span class="id" title="var">n</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span>. <span class="comment">(*&nbsp;n&nbsp;=&nbsp;0&nbsp;*)</span><br/>
</div>

<div class="doc">
Note that due to the implementation of <span class="inlinecode"><span class="id" title="var">ooExtendableAlong</span></span>, we actually have to use <span class="inlinecode"><span class="id" title="var">extP</span></span> twice (there should probably be a general cofixpoint lemma for this). 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; [ <span class="id" title="tactic">apply</span> <span class="id" title="var">extP</span> | <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">tt</span> ]. <span class="comment">(*&nbsp;n&nbsp;=&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; [ <span class="id" title="tactic">apply</span> <span class="id" title="var">extP</span> | ]. <span class="comment">(*&nbsp;n&nbsp;&gt;&nbsp;1&nbsp;*)</span><br/>
</div>

<div class="doc">
What remains is to extend families of paths. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>; <span class="id" title="var">rapply</span> (<span class="id" title="var">ooextendable_postcompose'</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">P</span> <span class="id" title="var">b</span> &lt;~&gt; <span class="id" title="var">Q</span> <span class="id" title="var">b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_path_TypeO</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">equiv_path_universe</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Conversely, if a map satisfies this elimination principle (expressed via extensions), then it is connected.  This completes the proof of Lemma 7.5.7 from the book. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">conn_map_from_extension_elim</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;: (<span class="id" title="keyword">forall</span> (<span class="id" title="var">P</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) {<span class="id" title="var">P_inO</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>:<span class="id" title="var">B</span>, <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">P</span> <span class="id" title="var">b</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>:<span class="id" title="var">A</span>, <span class="id" title="var">P</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ExtensionAlong</span> <span class="id" title="var">f</span> <span class="id" title="var">P</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hf</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isconnected_from_elim_to_O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">e</span> := <span class="id" title="var">Hf</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>)) <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> (<span class="id" title="var">a</span>;1))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">e</span>.1 <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>]. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> (<span class="id" title="var">e</span>.2).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.5.6: Connected maps compose and cancel on the right. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_compose</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> ? <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">g</span> <span class="id" title="var">P</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">P</span> (<span class="id" title="var">g</span> <span class="id" title="var">b</span>)) <span class="id" title="var">d</span>)); <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">conn_map_comp</span> <span class="id" title="var">g</span> <span class="id" title="var">P</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> @ <span class="id" title="var">conn_map_comp</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">P</span> (<span class="id" title="var">g</span> <span class="id" title="var">b</span>)) <span class="id" title="var">d</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelR_conn_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;:  <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> ? <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">conn_map_elim</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">P</span> (<span class="id" title="var">d</span> <span class="id" title="var">oD</span> <span class="id" title="var">f</span>)); <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pattern</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">conn_map_comp</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) <span class="id" title="var">P</span> (<span class="id" title="var">d</span> <span class="id" title="var">oD</span> <span class="id" title="var">f</span>) <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connected maps also cancel with equivalences on the other side. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelL_isequiv_conn_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsEquiv</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">srefine</span> (<span class="id" title="var">isconnected_equiv'</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>) (<span class="id" title="var">g</span> <span class="id" title="var">b</span>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">equiv_functor_sigma_id</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span> =&gt; <span class="id" title="var">equiv_ap</span> <span class="id" title="var">g</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>) <span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">cancelL_equiv_conn_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> &lt;~&gt; <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">g</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">cancelL_isequiv_conn_map</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>.<br/>

<br/>
</div>

<div class="doc">
The constant map to <span class="inlinecode"><span class="id" title="var">Unit</span></span> is connected just when its domain is. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_conn_map_to_unit</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>) <span class="id" title="var">tt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_sigma_contr</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">local</span>]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">isconnected_conn_map_to_unit</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_to_unit_isconnected</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">const_tt</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">u</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">equiv_sigma_contr</span> <span class="id" title="var">_</span>)^-1 <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Lemma&nbsp;7.5.10:&nbsp;A&nbsp;map&nbsp;to&nbsp;a&nbsp;type&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">O</span></span>&nbsp;exhibits&nbsp;its&nbsp;codomain&nbsp;as&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">O</span></span>-reflection&nbsp;of&nbsp;its&nbsp;domain&nbsp;if&nbsp;it&nbsp;is&nbsp;<span class="inlinecode"><span class="id" title="var">O</span></span>-connected.&nbsp;&nbsp;(The&nbsp;converse&nbsp;is&nbsp;true&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;<span class="inlinecode"><span class="id" title="var">O</span></span>&nbsp;is&nbsp;a&nbsp;modality.)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_O_rec_conn_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> (<span class="id" title="var">O_rec</span> (<span class="id" title="var">O</span> := <span class="id" title="var">O</span>) <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isequiv_adjointify</span> <span class="id" title="var">_</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">pattern</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">conn_map_elim</span> <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">ap</span> (<span class="id" title="var">O_rec</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">conn_map_comp</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@ <span class="id" title="var">O_rec_beta</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">O_indpaths</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">ap</span> <span class="id" title="var">_</span> (<span class="id" title="var">O_rec_beta</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>) @ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">conn_map_comp</span> <span class="id" title="var">f</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.5.12 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">ConnMapFunctorSigma</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">P</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>} {<span class="id" title="var">Q</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">P</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">Q</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">g</span> <span class="id" title="var">a</span>)}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_O_hfiber_functor_sigma</span> (<span class="id" title="var">b</span>:<span class="id" title="var">B</span>) (<span class="id" title="var">v</span>:<span class="id" title="var">Q</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">b</span>;<span class="id" title="var">v</span>)) &lt;~&gt; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">equiv_via</span> (<span class="id" title="var">O</span> {<span class="id" title="var">w</span> : <span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span> &amp; <span class="id" title="var">hfiber</span> (<span class="id" title="var">g</span> <span class="id" title="var">w</span>.1) ((<span class="id" title="var">w</span>.2)^ # <span class="id" title="var">v</span>)}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_functor</span>, <span class="id" title="var">hfiber_functor_sigma</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">equiv_via</span> (<span class="id" title="var">O</span> {<span class="id" title="var">w</span> : <span class="id" title="var">hfiber</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span> &amp; <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">g</span> <span class="id" title="var">w</span>.1) ((<span class="id" title="var">w</span>.2)^ # <span class="id" title="var">v</span>))}).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_sigma_O</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">equiv_sigma_contr</span>; <span class="id" title="tactic">intros</span> [<span class="id" title="var">a</span> <span class="id" title="var">p</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_functor_sigma</span> `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">b</span> <span class="id" title="var">v</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">contr_equiv'</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_inverse</span> (<span class="id" title="var">equiv_O_hfiber_functor_sigma</span> <span class="id" title="var">b</span> <span class="id" title="var">v</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_base_inhabited</span> (<span class="id" title="var">inh</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span>, <span class="id" title="var">Q</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>)}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">contr_equiv</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_O_hfiber_functor_sigma</span> <span class="id" title="var">b</span> (<span class="id" title="var">inh</span> <span class="id" title="var">b</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">ConnMapFunctorSigma</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.5.13.  The "if" direction is a special case of <span class="inlinecode"><span class="id" title="var">conn_map_functor_sigma</span></span>, so we prove only the "only if" direction. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_fiber</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">P</span> <span class="id" title="var">a</span> -&gt; <span class="id" title="var">Q</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">idmap</span> <span class="id" title="var">f</span>)}<br/>
&nbsp;&nbsp;: <span class="id" title="keyword">forall</span> <span class="id" title="var">a</span>, <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">isconnected_equiv'</span> <span class="id" title="var">O</span> (<span class="id" title="var">hfiber</span> (<span class="id" title="var">functor_sigma</span> <span class="id" title="var">idmap</span> <span class="id" title="var">f</span>) (<span class="id" title="var">a</span>;<span class="id" title="var">q</span>)) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="var">hfiber_functor_sigma_idmap</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma 7.5.14: Connected maps are inverted by <span class="inlinecode"><span class="id" title="var">O</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">O_inverts_conn_map</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_from_extendable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">extendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
As a consequence, connected maps between modal types are equivalences. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isequiv_conn_map_ino</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>} `{<span class="id" title="var">In</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsEquiv</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="var">isequiv_commsq'</span> <span class="id" title="var">f</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span>) (<span class="id" title="var">to</span> <span class="id" title="var">O</span> <span class="id" title="var">B</span>) (<span class="id" title="var">to_O_natural</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
Connectedness is preserved by <span class="inlinecode"><span class="id" title="var">O_functor</span></span>. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">conn_map_O_functor</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">O_functor</span> <span class="id" title="var">O</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">O_functor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">conn_map_compose</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connected maps are preserved by coproducts 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_sum</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_sum</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extension_functor_sum</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Connected maps are preserved by coequalizers 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_functor_coeq</span> {<span class="id" title="var">B</span> <span class="id" title="var">A</span> <span class="id" title="var">B'</span> <span class="id" title="var">A'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>} {<span class="id" title="var">f'</span> <span class="id" title="var">g'</span> : <span class="id" title="var">B'</span> -&gt; <span class="id" title="var">A'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_coeq</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extension_functor_coeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And by pushouts 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_functor_pushout</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>) {<span class="id" title="var">f'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">B'</span>} {<span class="id" title="var">g'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">l</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">l</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> (<span class="id" title="var">functor_pushout</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extension_functor_coeq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">extendable_functor_sum</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ConnectedMaps</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1270"></a><h2 class="section">Containment of (reflective) subuniverses</h2>

<div class="paragraph"> </div>

 One subuniverse is contained in another if every <span class="inlinecode"><span class="id" title="var">O1</span></span>-modal type is <span class="inlinecode"><span class="id" title="var">O2</span></span>-modal.  We define this parametrized by three universes: <span class="inlinecode"><span class="id" title="var">O1</span></span> and <span class="inlinecode"><span class="id" title="var">O2</span></span> are reflective subuniverses of <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">i1</span>}</span> and <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">i2</span>}</span> respectively, and the relation says that all types in <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}</span> that <span class="inlinecode"><span class="id" title="var">O1</span></span>-modal are also <span class="inlinecode"><span class="id" title="var">O2</span></span>-modal.  This implies <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i1</span></span> and <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span>, of course.  The most common application is when <span class="inlinecode"><span class="id" title="var">i1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">j</span></span>, but it's sometimes useful to talk about a subuniverse of a larger universe agreeing with a subuniverse of a smaller universe on the smaller universe.  
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">j</span>} (<span class="id" title="var">O1</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i1</span>}) (<span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i2</span>})<br/>
&nbsp;&nbsp;:= <span class="id" title="var">inO_leq</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}), <span class="id" title="var">In</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span> -&gt; <span class="id" title="var">In</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> {<span class="id" title="var">_</span>} <span class="id" title="var">A</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">subuniverse_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;O1 &lt;= O2" := (<span class="id" title="var">O_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>) : <span class="id" title="var">subuniverse_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">subuniverse_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">reflexive_O_leq</span> : <span class="id" title="var">Reflexive</span> <span class="id" title="var">O_leq</span> | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">O</span> <span class="id" title="var">A</span> ?; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">transitive_O_leq</span> : <span class="id" title="var">Transitive</span> <span class="id" title="var">O_leq</span> | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">O3</span> <span class="id" title="var">O12</span> <span class="id" title="var">O23</span> <span class="id" title="var">A</span> ?.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (@<span class="id" title="var">inO_leq</span> <span class="id" title="var">O2</span> <span class="id" title="var">O3</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (@<span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mapinO_O_leq</span> (<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse</span>) `{<span class="id" title="var">O1</span> &lt;= <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">MapIn</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">MapIn</span> <span class="id" title="var">O2</span> <span class="id" title="var">f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="var">rapply</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
This implies that every <span class="inlinecode"><span class="id" title="var">O2</span></span>-connected type is <span class="inlinecode"><span class="id" title="var">O1</span></span>-connected, and similarly for maps and equivalences.  We give universe annotations so that <span class="inlinecode"><span class="id" title="var">O1</span></span> and <span class="inlinecode"><span class="id" title="var">O2</span></span> don't have to be on the same universe, but we do have to have <span class="inlinecode"><span class="id" title="var">i1</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span> for this statement.  When <span class="inlinecode"><span class="id" title="var">i2</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i1</span></span> it seems that the statement might not be true unless the RSU on the larger universe is accessibly extended from the smaller one; see <span class="inlinecode"><span class="id" title="var">Localization.v</span></span>.  
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isconnected_O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O1</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i1</span>}) (<span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i2</span>}) `{<span class="id" title="var">O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">i1</span>} <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i1</span>}) `{<span class="id" title="var">IsConnected</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnected</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">isconnected_from_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">C</span> <span class="id" title="var">C1</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">isconnected_elim</span> <span class="id" title="var">O2</span>); <span class="id" title="var">srapply</span> <span class="id" title="var">inO_leq</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
This one has the same universe constraint <span class="inlinecode"><span class="id" title="var">i1</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">conn_map_O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O1</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i1</span>}) (<span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i2</span>}) `{<span class="id" title="var">O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">i1</span>} <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i1</span>}} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O1</span> <span class="id" title="var">f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
</div>

<div class="doc">
We could prove this by applying <span class="inlinecode"><span class="id" title="var">isconnected_O_leq</span></span> fiberwise, but unless we were very careful that would collapse the two universes <span class="inlinecode"><span class="id" title="var">i1</span></span> and <span class="inlinecode"><span class="id" title="var">i2</span></span>.  So instead we just give an analogous direct proof. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P_inO</span> <span class="id" title="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> (<span class="id" title="var">extension_conn_map_elim</span> <span class="id" title="var">O2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span>; <span class="id" title="var">rapply</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
This is Lemma 2.12(i) in CORS, again with the same universe constraint <span class="inlinecode"><span class="id" title="var">i1</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">O_inverts_O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O1</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i1</span>}) (<span class="id" title="var">O2</span> : <span class="id" title="var">ReflectiveSubuniverse@</span>{<span class="id" title="var">i2</span>}) `{<span class="id" title="var">O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">i1</span>} <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">Type@</span>{<span class="id" title="var">i1</span>}} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">O2</span> <span class="id" title="var">f</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">O1</span> <span class="id" title="var">f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span>}; <span class="id" title="tactic">intros</span> <span class="id" title="var">Z</span> <span class="id" title="var">Z_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">Z</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">lift_extendablealong@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">i1</span> <span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">i1</span>}).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">ooextendable_O_inverts</span> <span class="id" title="var">O2</span>); <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1271"></a><h2 class="section">Equality of (reflective) subuniverses</h2>

<div class="paragraph"> </div>

 Two subuniverses are the same if they have the same modal types.  The universe parameters are the same as for <span class="inlinecode"><span class="id" title="var">O_leq</span></span>: <span class="inlinecode"><span class="id" title="var">O1</span></span> and <span class="inlinecode"><span class="id" title="var">O2</span></span> are reflective subuniverses of <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">i1</span>}</span> and <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">i2</span>}</span>, and the relation says that they agree when restricted to <span class="inlinecode"><span class="id" title="var">Type@</span>{<span class="id" title="var">j</span>}</span>, where <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i1</span></span> and <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">i2</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Class</span> <span class="id" title="var">O_eq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">j</span>} (<span class="id" title="var">O1</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i1</span>}) (<span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse@</span>{<span class="id" title="var">i2</span>}) :=<br/>
{<br/>
&nbsp;&nbsp;<span class="id" title="var">O_eq_l</span> : <span class="id" title="var">O_leq@</span>{<span class="id" title="var">i1</span> <span class="id" title="var">i2</span> <span class="id" title="var">j</span>} <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> ;<br/>
&nbsp;&nbsp;<span class="id" title="var">O_eq_r</span> : <span class="id" title="var">O_leq@</span>{<span class="id" title="var">i2</span> <span class="id" title="var">i1</span> <span class="id" title="var">j</span>} <span class="id" title="var">O2</span> <span class="id" title="var">O1</span> ;<br/>
}.<br/>

<br/>
<span class="id" title="keyword">Global Existing Instances</span> <span class="id" title="var">O_eq_l</span> <span class="id" title="var">O_eq_r</span>.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;&lt;=&gt;" := <span class="id" title="var">O_eq</span> : <span class="id" title="var">subuniverse_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">issig_O_eq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">_</span> &lt;~&gt; <span class="id" title="var">O_eq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> := <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">issig</span>).<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">reflexive_O_eq</span> : <span class="id" title="var">Reflexive</span> <span class="id" title="var">O_eq</span> | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">transitive_O_eq</span> : <span class="id" title="var">Transitive</span> <span class="id" title="var">O_eq</span> | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">O3</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">y</span> := <span class="id" title="var">O2</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">symmetric_O_eq</span> : <span class="id" title="var">Symmetric</span> <span class="id" title="var">O_eq</span> | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> [? ?]; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">issig_subuniverse</span> : <span class="id" title="var">_</span> &lt;~&gt; <span class="id" title="var">Subuniverse</span> := <span class="id" title="keyword">ltac</span>:(<span class="id" title="var">issig</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">equiv_path_subuniverse</span> `{<span class="id" title="var">Univalence</span>} (<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;: (<span class="id" title="var">O1</span> &lt;=&gt; <span class="id" title="var">O2</span>) &lt;~&gt; (<span class="id" title="var">O1</span> = <span class="id" title="var">O2</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">_</span> <span class="id" title="var">oE</span> (<span class="id" title="var">issig_O_eq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>)^-1).<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>; <span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_path_along_equiv</span> <span class="id" title="var">issig_subuniverse</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_path_sigma_hprop</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">O1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">O1</span> [<span class="id" title="var">O1h</span> ?]]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">O2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">O2</span> [<span class="id" title="var">O2h</span> ?]]; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">equiv_path_arrow</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">oE</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">srapply</span> (<span class="id" title="var">equiv_iff_hprop</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">srapply</span> <span class="id" title="var">istrunc_sigma</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">O_leq</span>; <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">h</span> <span class="id" title="var">k</span>] <span class="id" title="var">A</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">h</span> <span class="id" title="var">A</span>); <span class="id" title="tactic">specialize</span> (<span class="id" title="var">k</span> <span class="id" title="var">A</span>); <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">path_universe_uncurried</span>, <span class="id" title="var">equiv_iff_hprop</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">h</span> <span class="id" title="var">A</span>); <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;1:<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2:<span class="id" title="tactic">rewrite</span> <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">exact</span> <span class="id" title="var">e</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
It should also be true that if <span class="inlinecode"><span class="id" title="var">O1</span></span> and <span class="inlinecode"><span class="id" title="var">O2</span></span> are reflective subuniverses, then <span class="inlinecode"><span class="id" title="var">O1</span></span> <span class="inlinecode">&lt;=&gt;</span> <span class="inlinecode"><span class="id" title="var">O2</span></span> is equivalent to <span class="inlinecode"><span class="id" title="var">O1</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">O2</span></span> <span class="inlinecode">:&gt;</span> <span class="inlinecode"><span class="id" title="var">ReflectiveSubuniverse</span></span>.  Probably <span class="inlinecode"><span class="id" title="var">contr_typeof_O_unit</span></span> should be useful in proving that. 
<div class="paragraph"> </div>

 Reflections into one subuniverse are also reflections into an equal one.  Unfortunately these almost certainly can't be <span class="inlinecode"><span class="id" title="keyword">Instance</span></span>s for fear of infinite loops, since <span class="inlinecode">&lt;=&gt;</span> is reflexive. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">prereflects_O_leq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse</span>) `{<span class="id" title="var">O1</span> &lt;= <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">PreReflects</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">PreReflects</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">O_reflector</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">rapply</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> (<span class="id" title="var">to</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reflects_O_eq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O1</span> <span class="id" title="var">O2</span> : <span class="id" title="var">Subuniverse</span>) `{<span class="id" title="var">O1</span> &lt;=&gt; <span class="id" title="var">O2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) `{<span class="id" title="var">Reflects</span> <span class="id" title="var">O1</span> <span class="id" title="var">A</span>}<br/>
&nbsp;&nbsp;: @<span class="id" title="var">Reflects</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span> (<span class="id" title="var">prereflects_O_leq</span> <span class="id" title="var">O1</span> <span class="id" title="var">O2</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">B</span> <span class="id" title="var">B_inO2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O2</span> <span class="id" title="var">O1</span> <span class="id" title="var">_</span> <span class="id" title="var">B_inO2</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">extendable_to_O</span> <span class="id" title="var">O1</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1272"></a><h2 class="section">Separated subuniverses</h2>

<div class="paragraph"> </div>

 For any subuniverse <span class="inlinecode"><span class="id" title="var">O</span></span>, a type is <span class="inlinecode"><span class="id" title="var">O</span></span>-separated iff all its identity types are <span class="inlinecode"><span class="id" title="var">O</span></span>-modal.  We will study these further in <span class="inlinecode"><span class="id" title="var">Separated.v</span></span>, but we put the definition here because it's needed in <span class="inlinecode"><span class="id" title="var">Descent.v</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Sep</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>) : <span class="id" title="var">Subuniverse</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">unshelve</span> <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">exact</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span>:<span class="id" title="var">A</span>), <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> ? <span class="id" title="var">f</span> ? <span class="id" title="var">x</span> <span class="id" title="var">y</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">inO_equiv_inO'</span> <span class="id" title="var">_</span> (<span class="id" title="var">equiv_ap</span> <span class="id" title="var">f</span>^-1 <span class="id" title="var">x</span> <span class="id" title="var">y</span>)^-1).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">inO_paths_SepO</span> (<span class="id" title="var">O</span> : <span class="id" title="var">Subuniverse</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">A_inO</span> : <span class="id" title="var">In</span> (<span class="id" title="var">Sep</span> <span class="id" title="var">O</span>) <span class="id" title="var">A</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">In</span> <span class="id" title="var">O</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;:= <span class="id" title="var">A_inO</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
TODO: Where to put this?  Morally it goes with the study of <span class="inlinecode">&lt;&lt;</span> in <span class="inlinecode"><span class="id" title="var">Modality.v</span></span> and <span class="inlinecode">&lt;&lt;&lt;</span> in <span class="inlinecode"><span class="id" title="var">Descent.v</span></span> and <span class="inlinecode"><span class="id" title="var">Sep</span></span> in <span class="inlinecode"><span class="id" title="var">Separated.v</span></span>, but it doesn't actually need any of those relations, only <span class="inlinecode"><span class="id" title="var">O'</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">Sep</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>, and it would also be nice to have it next to  <span class="inlinecode"><span class="id" title="var">O_inverts_functor_coeq</span></span>.  It's a variation on the latter: if <span class="inlinecode"><span class="id" title="var">O'</span></span> <span class="inlinecode">&lt;=</span> <span class="inlinecode"><span class="id" title="var">Sep</span></span> <span class="inlinecode"><span class="id" title="var">O</span></span>, then for <span class="inlinecode"><span class="id" title="var">O'</span></span> to invert <span class="inlinecode"><span class="id" title="var">functor_coeq</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode"><span class="id" title="var">k</span></span> it suffices that it invert <span class="inlinecode"><span class="id" title="var">k</span></span> and that <span class="inlinecode"><span class="id" title="var">h</span></span> be <span class="inlinecode"><span class="id" title="var">O</span></span>-connected (by <span class="inlinecode"><span class="id" title="var">conn_map_OO_inverts</span></span>, which has different hypotheses but applies in many of the same examples, that is a weaker assumption). 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_inverts_functor_coeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> <span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) `{<span class="id" title="var">O'</span> &lt;= <span class="id" title="var">Sep</span> <span class="id" title="var">O</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B'</span> <span class="id" title="var">A'</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f'</span> <span class="id" title="var">g'</span> : <span class="id" title="var">B'</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">O_inverts</span> <span class="id" title="var">O'</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">O'</span> (<span class="id" title="var">functor_coeq</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">O_inverts_from_extendable</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Z</span> <span class="id" title="var">Z_inO</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extendable_functor_coeq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">nrapply</span> (<span class="id" title="var">ooextendable_O_inverts</span> <span class="id" title="var">O'</span>); <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">pose</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O'</span> (<span class="id" title="var">Sep</span> <span class="id" title="var">O</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span>; <span class="id" title="var">rapply</span> (<span class="id" title="var">extendable_conn_map_inO</span> <span class="id" title="var">O</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And a similar property for pushouts 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_inverts_functor_pushout</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> <span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) `{<span class="id" title="var">O'</span> &lt;= <span class="id" title="var">Sep</span> <span class="id" title="var">O</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>) {<span class="id" title="var">f'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">B'</span>} {<span class="id" title="var">g'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">l</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">O'</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">O_inverts</span> <span class="id" title="var">O'</span> <span class="id" title="var">l</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">O_inverts</span> <span class="id" title="var">O'</span> (<span class="id" title="var">functor_pushout</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">nrapply</span> (<span class="id" title="var">OO_inverts_functor_coeq</span> <span class="id" title="var">O</span> <span class="id" title="var">O'</span>).<br/>
&nbsp;&nbsp;1,3:<span class="id" title="tactic">exact</span> <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">rapply</span> <span class="id" title="var">O_inverts_functor_sum</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
And similar properties for connected maps 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_conn_map_functor_coeq</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> <span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) `{<span class="id" title="var">O'</span> &lt;= <span class="id" title="var">Sep</span> <span class="id" title="var">O</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">B</span> <span class="id" title="var">A</span> <span class="id" title="var">B'</span> <span class="id" title="var">A'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">A</span>} {<span class="id" title="var">f'</span> <span class="id" title="var">g'</span> : <span class="id" title="var">B'</span> -&gt; <span class="id" title="var">A'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O'</span> (<span class="id" title="var">functor_coeq</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extension_functor_coeq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">pose</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O'</span> (<span class="id" title="var">Sep</span> <span class="id" title="var">O</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> (<span class="id" title="var">ooextendable_conn_map_inO</span> <span class="id" title="var">O</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">OO_conn_map_functor_pushout</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">O</span> <span class="id" title="var">O'</span> : <span class="id" title="var">ReflectiveSubuniverse</span>) `{<span class="id" title="var">O'</span> &lt;= <span class="id" title="var">Sep</span> <span class="id" title="var">O</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">C</span>) {<span class="id" title="var">f'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">B'</span>} {<span class="id" title="var">g'</span> : <span class="id" title="var">A'</span> -&gt; <span class="id" title="var">C'</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">h</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">A'</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">B</span> -&gt; <span class="id" title="var">B'</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">C</span> -&gt; <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">k</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> == <span class="id" title="var">f'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">l</span> <span class="id" title="var">o</span> <span class="id" title="var">g</span> == <span class="id" title="var">g'</span> <span class="id" title="var">o</span> <span class="id" title="var">h</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">h</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">k</span>} `{<span class="id" title="var">IsConnMap</span> <span class="id" title="var">O'</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">l</span>}<br/>
&nbsp;&nbsp;: <span class="id" title="var">IsConnMap</span> <span class="id" title="var">O'</span> (<span class="id" title="var">functor_pushout</span> <span class="id" title="var">h</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">conn_map_from_extension_elim</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extension_functor_coeq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">extendable_functor_sum</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">pose</span> (<span class="id" title="var">inO_leq</span> <span class="id" title="var">O'</span> (<span class="id" title="var">Sep</span> <span class="id" title="var">O</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rapply</span> <span class="id" title="var">ooextendable_conn_map_inO</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">inO_isequiv_to_O</span> : <span class="id" title="var">typeclass_instances</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">inO_unsigma</span> : <span class="id" title="var">typeclass_instances</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Immediate</span> <span class="id" title="var">isconnected_conn_map_to_unit</span> : <span class="id" title="var">typeclass_instances</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>